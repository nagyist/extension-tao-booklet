{"version":3,"sources":["routes.js","Booklet/editBooklet.js","Booklet/preview.js","Booklet/wizard.js","../../taoItems/assets/manager.js","../../taoItems/runner/api/itemRunner.js","../../taoQtiItem/qtiItem/core/qtiClasses.js","../../taoQtiItem/qtiItem/helper/util.js","../../taoQtiItem/qtiItem/helper/rendererConfig.js","../../taoQtiItem/qtiItem/core/Element.js","../../taoQtiItem/qtiItem/core/Loader.js","../../taoQtiItem/qtiItem/helper/interactionHelper.js","../../taoQtiItem/qtiRunner/core/Renderer.js","../../taoQtiItem/runner/provider/manager/picManager.js","../../taoQtiItem/runner/provider/manager/userModules.js","../../taoQtiPrint/qtiPrintRenderer/tpl/notYetSupported!tpl","../../taoQtiPrint/runner/provider/qtiprint.js","../../taoQtiPrint/runner/itemRunner.js","../../taoItems/assets/strategies.js","../../taoQtiPrint/lib/qrcode.js","../../taoQtiPrint/runner/tpl/pageTest!tpl","../../taoQtiPrint/runner/tpl/pageSection!tpl","../../taoQtiPrint/runner/tpl/pageBlock!tpl","../../taoQtiPrint/runner/testRenderers.js","../../taoQtiPrint/runner/testRunner.js","../tpl/print!tpl","PrintTest/render.js","../component/taskQueue.js","Results/printWizard.js"],"names":["define","Booklet","actions","editBooklet","wizard","preview","Results","printWizard","$","_","module","urlHelper","start","$downloader","hide","append","on","e","preventDefault","$form","target","closest","attr","route","uri","find","val","classUri","id","$frame","$container","css","height","urlUtil","strategies","data","options","cache","isArray","defaults","parseUrl","assetManager","_strategies","addStrategy","strategy","isPlainObject","isFunction","handle","isString","name","TypeError","this","push","setStrategies","newStrategies","self","forEach","length","setData","key","value","getData","resolve","url","resolved","inputUrl","hasOwnProperty","parse","result","resolveBy","clearCache","eventifier","assetManagerFactory","itemRunnerFactory","providerName","provider","providers","flow","init","done","pending","render","undefined","size","Error","keys","toString","container","newData","initDone","pendingTask","call","trigger","merge","assets","err","elt","renderDone","state","HTMLElement","setState","get","clear","clearDone","getState","getResponses","responses","renderFeedbacks","feedbacks","itemSession","register","_container","assessmentItem","responseProcessing","_simpleFeedbackRule","stylesheet","math","img","object","outcomeDeclaration","responseDeclaration","rubricBlock","associableHotspot","gap","gapImg","gapText","hotspotChoice","hottext","inlineChoice","simpleAssociableChoice","simpleChoice","associateInteraction","choiceInteraction","endAttemptInteraction","extendedTextInteraction","gapMatchInteraction","graphicAssociateInteraction","graphicGapMatchInteraction","graphicOrderInteraction","hotspotInteraction","hottextInteraction","inlineChoiceInteraction","matchInteraction","mediaInteraction","orderInteraction","prompt","selectPointInteraction","sliderInteraction","textEntryInteraction","uploadInteraction","feedbackBlock","feedbackInline","modalFeedback","customInteraction","infoControl","include","table","buildSerial","prefix","chars","i","charAt","Math","floor","random","buildId","item","usedIds","suffix","exists","getUsedIds","contains","buildIdentifier","useSuffix","getUsedIdentifiers","isUndefined","replace","findInCollection","element","collectionNames","searchedSerial","found","each","collectionName","collection","split","nameToken","parent","addMarkupNamespace","markup","ns","$0","$1","$2","$3","$4","indexOf","removeMarkupNamespaces","getMarkupUsedNamespaces","namespaces","original","slash","node","uniq","rendererConfigHelper","getOptionsFromArguments","args","placeholder","subclass","renderer","arg","isRenderer","console","log","Class","loggerFactory","util","rendererConfig","_instances","logger","Element","extend","qtiClass","serial","rootElement","attributes","metaData","match","setAttributes","initContainer","arguments","initObject","is","getSerial","elts","getComposingElements","prop","document","removeData","removeAttr","removeAttributes","getAttributes","clone","attrNames","getBody","getObject","v","isA","getUsedClasses","ret","composingElts","location","getRootElement","setRelatedItem","warn","setRootElement","getRelatedItem","setRenderer","getRenderer","_renderer","tplData","defaultData","tag","body","resolveUrl","rendering","renderTpl","replaceWith","postRender","altClassName","postRenderers","compact","getContainer","$scope","toArray","arr","type","isEmpty","addClass","className","clazz","_containClass","hasClass","removeClass","regex","RegExp","trim","toggleClass","isset","issetElement","unset","unsetElement","allClassStr","test","qtiElement","getElementBySerial","composingElements","qtiClasses","loadPortableCustomElementData","portableElement","typeIdentifier","entryPoint","properties","libraries","Loader","classesLocation","qti","setClassesLocation","getRequiredClasses","union","loadRequiredClasses","callback","reload","requiredClasses","required","requiredClass","_this","require","QtiClass","prototype","getLoadedClasses","loadItemData","Qti","loadContainer","outcomes","outcome","buildOutcome","addOutcomeDeclaration","feedback","buildElement","addModalFeedback","stylesheets","addStylesheet","response","buildResponse","addResponseDeclaration","feedbackRules","forIn","fbData","buildSimpleFeedbackRule","setResponseProcessing","buildResponseProcessing","setNamespaces","setSchemaLocations","schemaLocations","setApipAccessibility","apipAccessibility","loadAndBuildElement","loadElement","loadElementData","loadElements","allElements","elementData","template","howMatch","defaultValue","correctResponse","correctResponses","mapping","mapEntries","areaMapping","mappingAttributes","feedbackRule","setCondition","condition","comparedValue","feedbackOutcome","feedbackThen","modalFeedbacks","feedbackElse","comparedOutcome","rp","processingType","xml","bodyObject","bodyData","elements","eltData","setElement","bdy","loadObjectData","loadInteractionData","loadChoiceData","loadMathData","loadPicData","interaction","buildInteractionChoices","loadPciData","choices","set","matchSet","choice","addChoice","gapImgs","addGapImg","text","_alt","setMathML","mathML","annotations","encoding","setAnnotation","pci","pic","convertChoices","outputType","c","findChoices","inputType","getChoice","getChoiceByIdentifier","shuffleChoices","r","f","j","n","k","tmp","serialToIdentifier","choiceSerial","Handlebars","Promise","interactionHelper","themeLoader","getDocumentBaseUrl","window","protocol","host","pathname","_isValidRenderer","valid","classCorrect","_renderableClasses","pos","slice","subClass","_renderableSubclasses","_dependencies","_defaults","Renderer","registerRendererClass","list","success","_locations","_renderers","shuffledChoices","_getClassRenderer","setOption","setOptions","opts","getOption","getCustomMessage","elementName","messageKey","messages","compile","getAssetManager","getThemeLoader","qtiSubclass","res","decorators","isObject","before","after","renderDirect","tpl","setResponse","qtiInteraction","getResponse","resetResponse","destroy","getLoadedRenderers","renderersLocations","load","themes","base","available","theme","index","path","intersection","reqClass","deps","requiredSubClasses","values","unload","setShuffledChoices","identificationType","pluck","getShuffledChoices","reshuffle","returnedType","getChoices","getRenderers","getLocations","getAbsoluteUrl","relUrl","absUrl","runtimeLocations","runtimeLocation","setAreaBroker","areaBroker","_areaBroker","getAreaBroker","build","defaultOptions","NewRenderer","apply","picManager","_pic","_item","getPic","getItem","getTypeIdentifier","getDom","_dom","tool","children","first","button","broken","enable","dom","remove","disabled","disable","appendTo","offset","width","outerWidth","outerHeight","show","eventName","rest","unshift","picManagerCollection","getList","force","_list","_map","getElements","manager","managerFactory","picId","execute","action","executeAll","filter","cb","enablePic","disablePic","showPic","hidePic","enableAll","disableAll","showAll","hideAll","userModules","config","reject","dependency","exec","message","hb","depth0","helpers","partials","program1","stack1","helper","buffer","additional","hash","functionType","compilerInfo","inverse","noop","fn","program","__","context","QtiLoader","notYetSupportedTpl","getQtiRenderer","rendererType","QtiRendererPromise","rendererModules","locations","catch","error","missingSupport","label","identifier","timeout","results","booklet","bubbleSheet","itemData","then","QtiRenderer","rendererOptions","_loader","_itemData","showResponseIdentifier","innerHTML","trace","race","all","delay","getInteractions","itemRunner","qtiRuntimeProvider","prependToUrl","slashcat","directory","encodeURIComponent","file","baseUrl","isRelative","itemCssNoCache","bust","Date","now","external","isAbsolute","base64","isBase64","taomedia","QR8bitByte","mode","QRMode","MODE_8BIT_BYTE","parsedData","l","byteArray","code","charCodeAt","Array","concat","QRCodeModel","typeNumber","errorCorrectLevel","modules","moduleCount","dataCache","dataList","QRPolynomial","num","shift","QRRSBlock","totalCount","dataCount","QRBitBuffer","_getAndroid","android","sAgent","navigator","userAgent","aMat","parseFloat","_getTypeNumber","sText","nCorrectLevel","nType","_getUTF8Length","len","QRCodeLimitLength","nLimit","QRErrorCorrectLevel","L","M","Q","H","replacedText","encodeURI","QRCode","getLength","write","put","addData","isDark","row","col","getModuleCount","make","makeImpl","getBestMaskPattern","maskPattern","setupPositionProbePattern","setupPositionAdjustPattern","setupTimingPattern","setupTypeInfo","setupTypeNumber","createData","mapData","minLostPoint","pattern","lostPoint","QRUtil","getLostPoint","createMovieClip","target_mc","instance_name","depth","qr_mc","createEmptyMovieClip","y","x","dark","beginFill","moveTo","lineTo","endFill","getPatternPosition","bits","getBCHTypeNumber","mod","getBCHTypeInfo","inc","bitIndex","byteIndex","mask","getMask","PAD0","PAD1","rsBlocks","getRSBlocks","getLengthInBits","totalDataCount","putBit","createBytes","maxDcCount","maxEcCount","dcdata","ecdata","dcCount","ecCount","max","rsPoly","getErrorCorrectPolynomial","rawPoly","modPoly","modIndex","totalCodeCount","MODE_NUMBER","MODE_ALPHA_NUM","MODE_KANJI","QRMaskPattern","PATTERN000","PATTERN001","PATTERN010","PATTERN011","PATTERN100","PATTERN101","PATTERN110","PATTERN111","PATTERN_POSITION_TABLE","G15","G18","G15_MASK","d","getBCHDigit","digit","errorCorrectLength","a","multiply","QRMath","gexp","qrCode","sameCount","count","darkCount","abs","glog","LOG_TABLE","EXP_TABLE","ratio","RS_BLOCK_TABLE","rsBlock","getRsBlockTable","bufIndex","bit","svgDrawer","Drawing","el","htOption","_el","_htOption","draw","oQRCode","makeSVG","attrs","createElementNS","setAttribute","nCount","svg","viewBox","String","fill","colorLight","setAttributeNS","appendChild","colorDark","child","hasChildNodes","removeChild","lastChild","useSVG","documentElement","tagName","toLowerCase","CanvasRenderingContext2D","_onMakeImage","_elImage","src","_elCanvas","toDataURL","style","display","_safeSetDataURI","fSuccess","fFail","_fFail","_fSuccess","_bSupportDataURI","createElement","fOnError","fOnSuccess","onabort","onerror","onload","_android","factor","devicePixelRatio","drawImage","image","sx","sy","sw","sh","dx","dy","dw","dh","nodeName","_bIsPainted","_oContext","getContext","alt","nWidth","nHeight","nRoundedWidth","round","nRoundedHeight","bIsDark","nLeft","nTop","strokeStyle","lineWidth","fillStyle","fillRect","strokeRect","ceil","makeImage","isPainted","clearRect","nNumber","aHTML","join","elTable","childNodes","nLeftMarginTable","offsetWidth","nTopMarginTable","offsetHeight","margin","vOption","correctLevel","getElementById","_oQRCode","_oDrawing","makeCode","title","CorrectLevel","uniqid","escapeExpression","program3","logo","helperMissing","program5","subtitle","program7","date","program9","qrcode","assetStrategies","pageTestTpl","pageSectionTpl","testPage","coverPageOptions","cover_page","description","unique_id","sectionPage","section","itemPage","itemRef","itemState","itemDone","isDone","lang","assetsList","asset","asyncLib","testRenderers","pageBlockTpl","testDefinitions","createPage","$pageBlock","layoutOptions","layout","testDefinition","items","pageRenderers","empty","rtl","testData","states","partial","testParts","testPart","sections","href","regular","use_bubble_sheet","show_response_identifier","parallel","cls","testRunner","printTpl","showMessage","msg","printLayoutHacking","previous","pages","blankPage","$section","computePageFromHeight","nextUntil","ready","status","layoutClasses","one_page_item","one_page_section","setTimeout","$mainContainer","reduce","clearTimeout","taskQueueTableFactory","bookletTaskQueue","queueId","taskQueue","rows","dataUrl","statusUrl","removeUrl","hider","report","switchContainer","purpose","$containers","refreshTree","$header","displayReport","$reportContainer","$submitter","toggle","nested","fold","$formContainer","$sent","asyncQueue","off","params","instances","classes","parseInt","serializeArray","param","JSON","stringify","ajax","dataType","fileDownload","httpMethod","failCallback","successCallback","downloadUrl"],"mappings":"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AAA,IAAA,EAAA,IAAA,MAAA,EAAA,GAAA,GAAA,EAAA,GAAA,KAAA,GAAA,GAAA,GAAA,EAAA,GAAA,KAAA,GAAA,GAAA,GAAA,EAAA,GAAA,KAAA,EAAA,IAAA,GAAA,EAAA,IAAA,KAAA,EAAA,GAAA,GAAA,EAAA,GAAA,KAAA,EAAA,GAAA,GAAA,EAAA,GAAA,KAAA,GAAA,GAAA,KAAA,EAAA,IAAA,GAAA,EAAA,IAAA,KAAA,EAAA,GAAA,GAAA,EAAA,GAAA,KAAA,GAAA,GAAA,GAAA,EAAA,GAAA,KAAA,EAAA,GAAA,GAAA,GAAA,GAAA,KAAA,EAAA,IAAA,IAAA,EAAA,IAAA,MAAA,GAAA,GAAA,GAAA,EAAA,GAAA,KAAA,EAAA,GAAA,GAAA,GAAA,GAAA,KAAA,EAAA,GAAA,GAAA,GAAA,GAAA,KAAA,EAAA,IAAA,IAAA,EAAA,IAAA,MAAA,EAAA,GAAA,GAAA,EAAA,GAAA,KAAA,GAAA,GAAA,GAAA,EAAA,GAAA,KAAA,EAAA,GAAA,GAAA,GAAA,GAAA,KAAA,EAAA,IAAA,IAAA,EAAA,IAAA,MAAA,EAAA,GAAA,GAAA,GAAA,GAAA,KAAA,GAAA,GAAA,GAAA,EAAA,GAAA,KAAA,EAAA,GAAA,GAAA,GAAA,GAAA,KAAA,EAAA,IAAA,IAAA,EAAA,IAAA,MAAA,EAAA,GAAA,GAAA,GAAA,GAAA,KAAA,GAAA,GAAA,GAAA,EAAA,GAAA,KAAA,GAAA,GAAA,GAAA,GAAA,GAAA,KAAA,EAAA,IAAA,IAAA,EAAA,IAAA,MAAA,GAAA,GAAA,KAAA,GAAA,GAAA,GAAA,EAAA,GAAA,KAAA,GAAA,GAAA,GAAA,EAAA,GAAA,KAAA,EAAA,IAAA,IAAA,EAAA,IAAA,MAAA,GAAA,GAAA,KAAA,EAAA,GAAA,GAAA,GAAA,GAAA,KAAA,GAAA,GAAA,KAAA,EAAA,IAAA,IAAA,EAAA,IAAA,MAAA,EAAA,GAAA,GAAA,GAAA,GAAA,KAAA,GAAA,GAAA,GAAA,GAAA,GAAA,KAAA,GAAA,GAAA,GAAA,GAAA,GAAA,KAAA,EAAA,IAAA,IAAA,EAAA,IAAA,MAAA,EAAA,GAAA,GAAA,GAAA,GAAA,KAAA,GAAA,GAAA,GAAA,GAAA,GAAA,KAAA,GAAA,GAAA,GAAA,EAAA,GAAA,KAAA,EAAA,IAAA,IAAA,EAAA,IAAA,MAAA,EAAA,GAAA,GAAA,GAAA,GAAA,KAAA,EAAA,GAAA,GAAA,GAAA,GAAA,KAAA,GAAA,GAAA,GAAA,GAAA,GAAA,KAAA,GAAA,IAAA,IAAA,EAAA,IAAA,MAAA,GAAA,GAAA,GAAA,EAAA,GAAA,KAAA,GAAA,GAAA,GAAA,EAAA,GAAA,KAAA,GAAA,GAAA,GAAA,EAAA,GAAA,KAAA,EAAA,IAAA,IAAA,EAAA,IAAA,MAAA,GAAA,GAAA,GAAA,EAAA,GAAA,KAAA,EAAA,GAAA,GAAA,GAAA,GAAA,KAAA,GAAA,GAAA,GAAA,GAAA,GAAA,KAAA,EAAA,IAAA,IAAA,GAAA,IAAA,MAAA,EAAA,GAAA,GAAA,GAAA,GAAA,KAAA,EAAA,GAAA,GAAA,GAAA,GAAA,KAAA,GAAA,GAAA,GAAA,GAAA,GAAA,KAAA,EAAA,IAAA,IAAA,EAAA,IAAA,MAAA,GAAA,GAAA,GAAA,EAAA,GAAA,KAAA,EAAA,GAAA,GAAA,GAAA,GAAA,KAAA,GAAA,GAAA,GAAA,GAAA,GAAA,KAAA,EAAA,IAAA,IAAA,GAAA,IAAA,MAAA,GAAA,GAAA,GAAA,GAAA,GAAA,KAAA,GAAA,GAAA,GAAA,GAAA,GAAA,KAAA,GAAA,GAAA,GAAA,GAAA,GAAA,KAAA,GAAA,IAAA,IAAA,EAAA,IAAA,MAAA,EAAA,GAAA,GAAA,GAAA,GAAA,KAAA,GAAA,GAAA,GAAA,EAAA,GAAA,KAAA,GAAA,GAAA,GAAA,GAAA,GAAA,KAAA,GAAA,IAAA,MAAA,GAAA,GAAA,GAAA,GAAA,GAAA,KAAA,GAAA,GAAA,GAAA,GAAA,GAAA,KAAA,GAAA,GAAA,GAAA,GAAA,GAAA,KAAA,GAAA,IAAA,IAAA,EAAA,IAAA,MAAA,GAAA,GAAA,GAAA,GAAA,GAAA,KAAA,GAAA,GAAA,GAAA,GAAA,GAAA,KAAA,GAAA,GAAA,GAAA,GAAA,GAAA,KAAA,GAAA,IAAA,IAAA,EAAA,IAAA,MAAA,GAAA,GAAA,GAAA,GAAA,GAAA,KAAA,GAAA,GAAA,GAAA,EAAA,G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","file":"routes.js","sourcesContent":["/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\n\n//@see http://forge.taotesting.com/projects/tao/wiki/Front_js\ndefine('taoBooklet/controller/routes',[],function () {\n    'use strict';\n\n    return {\n        'Booklet': {\n            'actions': {\n                'editBooklet' : 'controller/Booklet/editBooklet',\n                'wizard'      : 'controller/Booklet/wizard',\n                'preview'     : 'controller/Booklet/preview'\n            }\n        },\n        'Results': {\n            'actions': {\n                'printWizard' : 'controller/Results/printWizard'\n            }\n        }\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n */\ndefine('taoBooklet/controller/Booklet/editBooklet',['jquery', 'lodash', 'module', 'util/url'], function ($, _, module, urlHelper) {\n    'use strict';\n\n    return {\n        start: function () {\n\n            var $downloader = $('<iframe/>').hide();\n            $('form').append($downloader);\n\n            $('.btn-download').on('click', function (e) {\n                e.preventDefault();\n                var $form = $(e.target).closest('form');\n\n                $downloader.attr('src', urlHelper.route('download', 'Booklet', 'taoBooklet', {\n                    uri: $form.find('input[name=\"uri\"]').val(),\n                    classUri: $form.find('input[name=\"classUri\"]').val(),\n                    id: $form.find('input[name=\"id\"]').val()\n                }));\n            });\n        }\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA;\n *\n */\n\n/**\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\ndefine('taoBooklet/controller/Booklet/preview',['jquery'], function ($) {\n    'use strict';\n\n    return {\n        start: function () {\n\n            //resize the frame to it's container height\n            var $frame = $('.preview-test');\n            var $container  = $frame.closest('.content-container');\n            $frame.css('min-height', ($container.height() - 50) + 'px' );\n        }\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n */\ndefine('taoBooklet/controller/Booklet/wizard',['jquery'], function ($) {\n    'use strict';\n\n    return {\n        start: function () {\n\n            var $form = $('.main-container ').find('form');\n\n        }\n    };\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA;\n *\n */\n\n/**\n * The asset manager proposes you to resolve your asset URLs for you!\n * You need to add the resolution strategies, it will then evaluate each strategy until the right one is found\n *\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\ndefine('taoItems/assets/manager',[\n    'lodash',\n    'util/url'\n], function(_, urlUtil){\n    'use strict';\n\n    /**\n     * @typedef AssetStrategy Defines a way to resolve an asset path\n     * @property {String} name - the strategy name\n     * @property {assetStrategyHandle} handle - how to resolve the strategy.\n     */\n\n    /**\n     * @callback assetStrategyHandle\n     * @param {String|Object} url - the URL to resolved. If parseUrl, it's an object that contains host, port, search, queryString, etc.\n     * @param {Object} data - the context data\n     * @returns {String?} falsy if not resolved otherwise the resolved URL\n     */\n\n\n    /**\n     * The assetManagerFactory create a new assetManager with the given resolution stratgies and a data context.\n     *\n     * @example\n     *   //define AssetStrategies with a name and a handle method\n     *   var strategies = [{\n     *       name : 'external',\n     *       handle : function(url, data){\n     *           if(/^http/.test(url)){\n     *               return path;\n     *           }\n     *       }\n     *   }, {\n     *       name : 'relative',\n     *       handle : function(url, data){\n     *           if(/^((\\.\\/)|(\\w\\/))/){\n     *               return data.baseUrl + '/' + url ;\n     *           }\n     *       }\n     *   }]);\n     *\n     *   var assetManager = assetManagerFactory(strategies, { baseUrl : 'http://t.oa/public/assets/' });\n     *   assetManager.resolve('http://foo/bar.png'); //will resolved using external\n     *   assetManager.resolve('bar.png'); //will resolved using relative strategy\n     *\n     * @param {AssetStrategy[]} strategies - the strategies\n     * @param {Object} data - the context data\n     * @param {Object} [options] - the manager options\n     * @param {Boolean} [options.parseUrl = true] - If the URL to give to the stragies should be parsed or given as it is.\n     * @param {Boolean} [options.cache] - resolve the same URL only once and store the result in memory.\n     *\n     * @exports taoItems/assets/manager\n     * @namespace assetManagerFactory\n     */\n    var assetManagerFactory = function assetManagerFactory(strategies, data, options) {\n\n        var cache  = {};\n\n        strategies = _.isArray(strategies) ? strategies : [strategies];\n        data       = data || {};\n        options    = _.defaults(options || {}, {\n            parseUrl : true\n        });\n\n        /**\n         * A brand new asset manager is created by the factory\n         */\n        var assetManager = {\n\n            /**\n             * The stack of strategies that would be used to resolve the asset path\n             * @type {AssetStrategy[]}\n             */\n            _strategies : [],\n\n            /**\n             * Add an asset resolution strategy.\n             * The strategies will be evaluated in the order they've been added.\n             * @param {AssetStrategy} strategy - the strategy to add\n             * @throws {TypeError} if the strategy isn't defined correctly\n             */\n            addStrategy : function addStrategy (strategy){\n\n                if(!_.isPlainObject(strategy) || !_.isFunction(strategy.handle) || !_.isString(strategy.name)){\n                    throw new TypeError('An asset resolution strategy is an object with a handle method and a name');\n                }\n\n                this._strategies.push(strategy);\n            },\n\n            /**\n             * Change the strategies\n             * @param {AssetStrategy[]} strategies - the strategies\n             * @throws {TypeError} if the strategy isn't defined correctly\n             */\n            setStrategies : function setStrategies(newStrategies){\n                var self = this;\n\n                this._strategies = [];\n\n                //assign the strategies to the assetManager\n                _.forEach(newStrategies, function(strategy){\n\n                    //if it's an object we add it directly\n                    if(_.isPlainObject(strategy)){\n                        assetManager.addStrategy(strategy);\n\n                    //if it's a function, we create the strategy with a generated name\n                    } else if(_.isFunction(strategy)){\n                        self.addStrategy({\n                            name   : 'strategy_' + (self._strategies.length + 1),\n                            handle : strategy\n                        });\n                    }\n                });\n            },\n\n            /**\n             * Set context data\n             * @param {String|Object} [key] - the key of the data to set or the data values if it's an object\n             * @param {*} [value] - the value to set if a key is given\n             */\n            setData : function setData(key, value){\n                if(_.isString(key) && typeof value !== 'undefined'){\n                    data[key] = value;\n                } else if(_.isPlainObject(key)){\n                    data = key;\n                }\n            },\n\n            /**\n             * Get context data\n             * @param {String} [key] - if we want the value of a particuar key\n             * @returns {Object|*} all the data or the proprety value if key is given\n             */\n            getData : function getData(key){\n                if(_.isString(key)){\n                    return data[key];\n                }\n                return data;\n            },\n\n            /**\n             * Resolve the given URL against the strategies\n             * @param {String} url - the URL to resolve\n             * @returns {String?} the resolved URL or nothing\n             */\n            resolve : function resolve(url){\n                var resolved;\n                var inputUrl;\n\n                //if caching try to load the value from the cache\n                if(options.cache && cache.hasOwnProperty(url)){\n                    return cache[url];\n                }\n\n                //parse the url ?\n                inputUrl = options.parseUrl ? urlUtil.parse(url) : url;\n\n                //call strategies handlers, in their order until once returns somethin\n                _.forEach(this._strategies, function(strategy){\n                    var result = strategy.handle(inputUrl, data);\n                    if(result){\n                        resolved = result;\n                        return false;\n                    }\n                });\n\n                resolved = resolved || '';\n\n                if(options.cache){\n                    cache[url] = resolved;\n                }\n\n                return resolved;\n            },\n\n            /**\n             * Resolve the given URL against the strategy identified by the given name\n             * @param {String} name - the strategy name\n             * @param {String} url - the URL to resolve\n             * @returns {String?} the resolved URL or nothing\n             */\n            resolveBy : function resolveBy(name, url){\n                var inputUrl;\n                var resolved = '';\n                var strategy = _.find(this._strategies, {name : name});\n                if(strategy){\n                    //parse the url ?\n                    inputUrl = options.parseUrl ? urlUtil.parse(url) : url;\n                    resolved = strategy.handle(inputUrl, data);\n                }\n                return resolved;\n            },\n\n            /**\n             * When the cache is used, it could be useful to clear the cache\n             */\n            clearCache : function clearCache(){\n                if(options.cache){\n                    cache = {};\n                }\n            }\n        };\n\n        assetManager.setStrategies(strategies);\n\n        return assetManager;\n    };\n\n    return assetManagerFactory;\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014 (original work) Open Assessment Technlogies SA (under the project TAO-PRODUCT);\n *\n */\n\n/**\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\ndefine('taoItems/runner/api/itemRunner',[\n    'jquery',\n    'lodash',\n    'core/eventifier',\n    'taoItems/assets/manager'\n], function($, _, eventifier, assetManagerFactory){\n    'use strict';\n\n     /**\n     *\n     * Builds a brand new {@link itemRunner}.\n     *\n     * <strong>The factory is an internal mechanism to create encapsulated contexts.\n     *  I suggest you to use directly the name <i>itemRunner</i> when you require this module.</strong>\n     *\n     * @example require(['itemRunner'], function(itemRunner){\n                    itemRunner({itemId : 12})\n     *                    .on('statechange', function(state){\n     *\n     *                    })\n     *                    .on('ready', function(){\n     *\n     *                    })\n     *                    .on('response', function(){\n     *\n     *                    })\n     *                   .init()\n     *                   .render($('.item-container'));\n     *          });\n     *\n     * @exports itemRunner\n     * @namespace itemRunnerFactory\n     *\n     * @param {String} [providerName] - the name of a provider previously registered see {@link itemRunnerFactory#register}\n     * @param {Object} [data] - the data of the item to run\n     *\n     * @returns {itemRunner}\n     */\n    var itemRunnerFactory = function itemRunnerFactory(providerName, data, options){\n\n        var provider,\n            providers,\n            assetManager;\n\n        //contains the bound events.\n        var events = {};\n\n        //flow structure to manage sync calls in an async context.\n        var flow = {\n            init : {\n                done: false,\n                pending : []\n            },\n            render : {\n                done: false,\n                pending : []\n            }\n        };\n\n        //optional params based on type\n        if(_.isPlainObject(providerName)){\n            data = providerName;\n            providerName = undefined;\n        }\n\n        data = data || {};\n        options = options || {};\n\n        /*\n         * Select the provider\n         */\n        providers = itemRunnerFactory.providers;\n\n        //check a provider is available\n        if(!providers || _.size(providers) === 0){\n            throw new Error('No provider regitered');\n        }\n\n        if(_.isString(providerName) && providerName.length > 0){\n            provider = providers[providerName];\n        } else if(_.size(providers) === 1) {\n\n            //if there is only one provider, then we take this one\n            providerName = _.keys(providers)[0];\n            provider = providers[providerName];\n        }\n\n        //now we should have a provider\n        if(!provider){\n            throw new Error('No candidate found for the provider');\n        }\n\n        //set up a default assetManager using a \"do nothing\" strategy\n        assetManager = options.assetManager || assetManagerFactory(function defaultStrategy(url){\n            return url.toString();\n        });\n\n\n       /**\n        * The itemRunner\n        * @typedef {Object} itemRunner\n        */\n\n        /**\n        * @type {itemRunner}\n        * @lends itemRunnerFactory\n        */\n        return eventifier({\n\n            /**\n             * Items container\n             * @type {HTMLElement}\n             */\n            container : null,\n\n            /**\n             * The asset manager used to resolve asset\n             * @see taoItems/asset/manager\n             * @type {AssetManager}\n             */\n            assetManager : assetManager,\n\n            /**\n             * To give options to the item runner provider\n             * @type {Object}\n             */\n            options : options,\n\n            /**\n             * Initialize the runner.\n             * @param {Object} [newData] - just in case you want to change item data (it should not occurs in most case)\n             * @returns {itemRunner} to chain calls\n             *\n             * @fires itemRunner#init\n             */\n            init : function(newData){\n                var self = this;\n\n                /**\n                 * Call back when init is done\n                 */\n                var initDone = function initDone(){\n\n                   //manage pending tasks the first time\n                    if(flow.init.done === false){\n                        flow.init.done = true;\n\n                        _.forEach(flow.init.pending, function(pendingTask){\n                            if(_.isFunction(pendingTask)){\n                                pendingTask.call(self);\n                            }\n                        });\n                        flow.init.pending = [];\n                    }\n\n                    /**\n                     * the runner has initialized correclty the item\n                     * @event itemRunner#init\n                     */\n                    self.trigger('init');\n                };\n\n                //merge data\n                if(newData){\n                    data = _.merge(data, newData);\n                }\n\n                if(_.isFunction(provider.init)){\n\n                    /**\n                     * Calls provider's initialization with item data.\n                     * @callback InitItemProvider\n                     * @param {Object} data - the item data\n                     * @param {Function} done - call once the initialization is done\n                     */\n                    provider.init.call(this, data, initDone);\n\n                } else {\n                    initDone();\n                }\n\n                return this;\n            },\n\n            /**\n             * Configure the assetManager\n             * @see taoItems/assets/manager\n             * @param {AssetStrategy[]} strategies - the resolving strategies\n             * @param {Object} [data] - the context data\n             * @param {Object} [options] - the asset manager options\n             * @returns {itemRunner} to chain calls\n             */\n            assets : function assets(strategies, data, options){\n\n                try{\n                    this.assetManager = assetManagerFactory(strategies, data, options);\n                } catch( err ){\n                    this.trigger('error', 'Something was wrong while configuring the asset manager : ' + err);\n                }\n\n                return this;\n            },\n\n            /**\n             * Initialize the current item.\n             *\n             * @param {HTMLElement|jQueryElement} elt - the DOM element that is going to contain the rendered item.\n             * @returns {itemRunner} to chain calls\n             *\n             * @fires itemRunner#ready\n             * @fires itemRunner#render\n             * @fires itemRunner#error if the elt isn't valid\n             *\n             * @fires itemRunner#statechange the provider is reponsible to trigger this event\n             * @fires itemRunner#responsechange  the provider is reponsible to trigger this event\n             */\n           render : function(elt, options){\n                var self = this;\n\n                /**\n                 * Call back when render is done\n                 */\n                var renderDone = function renderDone (){\n\n                    //manage pending tasks the first time\n                    if(flow.render.done === false){\n                        flow.render.done = true;\n\n                        _.forEach(flow.render.pending, function(pendingTask){\n                            if(_.isFunction(pendingTask)){\n                                pendingTask.call(self);\n                            }\n                        });\n                        flow.render.pending = [];\n                    }\n\n                    /**\n                     * The item is rendered\n                     * @event itemRunner#render\n                     */\n                    self.trigger('render');\n\n                    /**\n                     * The item is ready.\n                     * Alias of {@link itemRunner#render}\n                     * @event itemRunner#ready\n                     */\n                    self.trigger('ready');\n                };\n\n                options = _.defaults(options || {}, {state : {}});\n\n                //check elt\n                if( !(elt instanceof HTMLElement) && !(elt instanceof $) ){\n                    return self.trigger('error', 'A valid HTMLElement (or a jquery element) at least is required to render the item');\n                }\n\n                //set item state to restore item state after rendering if the provider enables it\n                if(options.state){\n                    this.setState(options.state);\n                }\n\n                if(flow.init.done === false){\n                    flow.init.pending.push(function(){\n                        this.render(elt, options);\n                    });\n                } else {\n\n                    //we keep a reference to the container\n                    if(elt instanceof $){\n                        this.container = elt.get(0);\n                    } else {\n                        this.container = elt;\n                    }\n\n                    //the state will be applied only when the rendering is made\n\n                    if(_.isFunction(provider.render)){\n\n                        /**\n                         * Calls the provider's render\n                         * @callback RendertItemProvider\n                         * @param {HTMLElement} elt - the element to render inside\n                         * @param {Function} done - call once the render is done\n                         * @param {Object} [options] - the array of options that the item runner provider may supports\n                         * @param {Object} [options.state] - pass initial item state to method render() in case the item runner provider require initial state to render\n                         */\n                        provider.render.call(this, this.container, renderDone, options);\n\n                    } else {\n                        renderDone();\n                    }\n                }\n\n                return this;\n           },\n\n           /**\n            * Clear the running item.\n            * @returns {itemRunner}\n            *\n            * @fires itemRunner#clear\n            */\n           clear : function(){\n                var self = this;\n\n                /**\n                 * Call back when clear is done\n                 */\n                var clearDone = function clearDone (){\n\n                    //events = {};\n\n                    /**\n                     * The item is ready.\n                     * @event itemRunner#clear\n                     */\n                    self.trigger('clear');\n                };\n                if(_.isFunction(provider.clear)){\n\n                    /**\n                     * Calls the provider's clear\n                     * @callback ClearItemProvider\n                     * @param {HTMLElement} elt - item's container\n                     * @param {Function} done - call once the initialization is done\n                     */\n                    provider.clear.call(this, this.container, clearDone);\n\n                } else {\n                    clearDone();\n                }\n\n                return this;\n           },\n\n           /**\n            * Get the current state of the running item.\n            *\n            * @returns {Object|Null} state\n            */\n           getState : function(){\n                var state = null;\n                if(_.isFunction(provider.getState)){\n\n                    /**\n                     * Calls the provider's getState\n                     * @callback GetStateItemProvider\n                     * @returns {Object} the state\n                     */\n                    state = provider.getState.call(this);\n                }\n                return state;\n           },\n\n           /**\n            * Set the current state of the running item.\n            * This should have the effect to restore the item state.\n            *\n            * @param {Object} state - the new state\n            * @returns {itemRunner}\n            *\n            * @fires itemRunner#error if the state type doesn't match\n            */\n           setState : function(state){\n\n                if(!_.isPlainObject(state)){\n                    return this.trigger('error', \"The item's state must be a JavaScript Plain Object: \" + (typeof state) + ' given');\n                }\n\n                //the state will be applied only when the rendering is made\n                if(flow.render.done === false){\n                    flow.render.pending.push(function(){\n                        this.setState(state);\n                    });\n                } else {\n\n                    if(_.isFunction(provider.setState)){\n\n                        /**\n                         * Calls the provider's setState\n                         * @callback SetStateItemProvider\n                         * @param {Object} state -  the state to set\n                         */\n                        provider.setState.call(this, state);\n                    }\n                }\n                return this;\n           },\n\n           /**\n            * Get the responses of the running item.\n            *\n            * @returns {Object} the item's responses\n            */\n           getResponses : function(){\n                var responses = {};\n                if(_.isFunction(provider.getResponses)){\n\n                    /**\n                     * Calls the provider's getResponses\n                     * @callback GetResponsesItemProvider\n                     * @returns {Object} the responses\n                     */\n                    responses = provider.getResponses.call(this);\n                }\n                return responses;\n           },\n\n            /**\n             * Append the modalFeedbacks into the item and create queue of feedbacks that should be displayed to the user\n             *\n             * @param {Object|Array} feedbacks - all feedbacks of the item\n             * @param {Object|Array} itemSession - determine feedbacks which should be displayed\n             * @param {function} done(renderingQueue) - runs after loading feedbacks into the item\n             *      # have parameter {Object|Array} renderingQueue with prepared queue of the feedbacks for displaying to the user\n             *\n             *\n             * Example:\n             *\n             *    this.renderFeedbacks({f1: 'feedback1', f2: 'feedback2', f3: 'feedback3'}, ['f2'], function(renderingQueue){\n             *      renderingQueue; // {'feedback2'}\n             *    });\n             */\n            renderFeedbacks : function renderFeedbacks(feedbacks, itemSession, done){\n                if(_.isFunction(provider.renderFeedbacks)) {\n                    provider.renderFeedbacks.call(this, feedbacks, itemSession, done);\n                }\n            }\n        });\n    };\n\n    /**\n     * Register an <i>Item Runtime Provider</i> into the item runner.\n     * The provider provides the behavior required by the item runner.\n     *\n     * @param {String} name - the provider name will be used to select the provider while instantiating the runner\n     *\n     * @param {Object} provider - the Item Runtime Provider as a plain object. The itemRunner forwards encapsulate and delegate calls to the provider.\n     * @param {InitItemProvider} provider.init - the provider initializes the item from it's data, for example loading libraries, add some listeners, etc.\n     * @param {RenderItemProvider} provider.render - the provider renders the item within the given container element.\n     * @param {ClearItemProvider} [provider.clear] - the provider clears the item.\n     * @param {GetStateItemProvider} [provider.getState] - the provider get the item's state.\n     * @param {SetStateItemProvider} [provider.setState] - the provider restore the item to the given state.\n     * @param {GetRespnsesItemProvider} [provider.getResponses] - the provider gives the current responses.\n     *\n     * @throws TypeError when a wrong provider is given or an empty name.\n     */\n    itemRunnerFactory.register = function registerProvider(name, provider){\n        //type checking\n        if(!_.isString(name) || name.length <= 0){\n            throw new TypeError('It is required to give a name to your provider.');\n        }\n        if(!_.isPlainObject(provider) || (!_.isFunction(provider.init) && !_.isFunction(provider.render))){\n            throw new TypeError('A provider is an object that contains at least an init function or a render function.');\n        }\n\n        this.providers = this.providers || {};\n        this.providers[name] = provider;\n    };\n\n    return itemRunnerFactory;\n});\n\n","define('taoQtiItem/qtiItem/core/qtiClasses',[], function(){\n    return {\n        '_container' : 'taoQtiItem/qtiItem/core/Container',\n        'assessmentItem' : 'taoQtiItem/qtiItem/core/Item',\n        'responseProcessing' : 'taoQtiItem/qtiItem/core/ResponseProcessing',\n        '_simpleFeedbackRule' : 'taoQtiItem/qtiItem/core/response/SimpleFeedbackRule',\n        'stylesheet' : 'taoQtiItem/qtiItem/core/Stylesheet',\n        'math' : 'taoQtiItem/qtiItem/core/Math',\n        'img' : 'taoQtiItem/qtiItem/core/Img',\n        'object' : 'taoQtiItem/qtiItem/core/Object',\n        'outcomeDeclaration' : 'taoQtiItem/qtiItem/core/variables/OutcomeDeclaration',\n        'responseDeclaration' : 'taoQtiItem/qtiItem/core/variables/ResponseDeclaration',\n        'rubricBlock' : 'taoQtiItem/qtiItem/core/RubricBlock',\n        'associableHotspot' : 'taoQtiItem/qtiItem/core/choices/AssociableHotspot',\n        'gap' : 'taoQtiItem/qtiItem/core/choices/Gap',\n        'gapImg' : 'taoQtiItem/qtiItem/core/choices/GapImg',\n        'gapText' : 'taoQtiItem/qtiItem/core/choices/GapText',\n        'hotspotChoice' : 'taoQtiItem/qtiItem/core/choices/HotspotChoice',\n        'hottext' : 'taoQtiItem/qtiItem/core/choices/Hottext',\n        'inlineChoice' : 'taoQtiItem/qtiItem/core/choices/InlineChoice',\n        'simpleAssociableChoice' : 'taoQtiItem/qtiItem/core/choices/SimpleAssociableChoice',\n        'simpleChoice' : 'taoQtiItem/qtiItem/core/choices/SimpleChoice',\n        'associateInteraction' : 'taoQtiItem/qtiItem/core/interactions/AssociateInteraction',\n        'choiceInteraction' : 'taoQtiItem/qtiItem/core/interactions/ChoiceInteraction',\n        'endAttemptInteraction' : 'taoQtiItem/qtiItem/core/interactions/EndAttemptInteraction',\n        'extendedTextInteraction' : 'taoQtiItem/qtiItem/core/interactions/ExtendedTextInteraction',\n        'gapMatchInteraction' : 'taoQtiItem/qtiItem/core/interactions/GapMatchInteraction',\n        'graphicAssociateInteraction' : 'taoQtiItem/qtiItem/core/interactions/GraphicAssociateInteraction',\n        'graphicGapMatchInteraction' : 'taoQtiItem/qtiItem/core/interactions/GraphicGapMatchInteraction',\n        'graphicOrderInteraction' : 'taoQtiItem/qtiItem/core/interactions/GraphicOrderInteraction',\n        'hotspotInteraction' : 'taoQtiItem/qtiItem/core/interactions/HotspotInteraction',\n        'hottextInteraction' : 'taoQtiItem/qtiItem/core/interactions/HottextInteraction',\n        'inlineChoiceInteraction' : 'taoQtiItem/qtiItem/core/interactions/InlineChoiceInteraction',\n        'matchInteraction' : 'taoQtiItem/qtiItem/core/interactions/MatchInteraction',\n        'mediaInteraction' : 'taoQtiItem/qtiItem/core/interactions/MediaInteraction',\n        'orderInteraction' : 'taoQtiItem/qtiItem/core/interactions/OrderInteraction',\n        'prompt' : 'taoQtiItem/qtiItem/core/interactions/Prompt',\n        'selectPointInteraction' : 'taoQtiItem/qtiItem/core/interactions/SelectPointInteraction',\n        'sliderInteraction' : 'taoQtiItem/qtiItem/core/interactions/SliderInteraction',\n        'textEntryInteraction' : 'taoQtiItem/qtiItem/core/interactions/TextEntryInteraction',\n        'uploadInteraction' : 'taoQtiItem/qtiItem/core/interactions/UploadInteraction',\n        'feedbackBlock' : 'taoQtiItem/qtiItem/core/feedbacks/FeedbackBlock',\n        'feedbackInline' : 'taoQtiItem/qtiItem/core/feedbacks/FeedbackInline',\n        'modalFeedback' : 'taoQtiItem/qtiItem/core/feedbacks/ModalFeedback',\n        'customInteraction' : 'taoQtiItem/qtiItem/core/interactions/CustomInteraction',\n        'infoControl' : 'taoQtiItem/qtiItem/core/PortableInfoControl',\n        'include' : 'taoQtiItem/qtiItem/core/Include',\n        'table' : 'taoQtiItem/qtiItem/core/Table'\n    };\n});\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA\n *\n */\n\n/**\n * Common basic util functions\n */\ndefine('taoQtiItem/qtiItem/helper/util',['lodash'], function(_){\n    'use strict';\n\n    var util = {\n\n        buildSerial : function buildSerial(prefix){\n            var id = prefix || '';\n            var chars = \"abcdefghijklmnopqrstuvwxyz0123456789\";\n            for(var i = 0; i < 22; i++){\n                id += chars.charAt(Math.floor(Math.random() * chars.length));\n            }\n            return id;\n        },\n\n        /**\n         * Generates an id for a Qti element (the generation is different from identifier)\n         * @param {Object} item - the element related item\n         * @param {String} prefix - identifier prefix\n         * @returns {String} the identifier\n         * @throws {TypeError} if there is no item\n         */\n        buildId : function buildId(item, prefix){\n            var id;\n            var usedIds;\n            var i = 1;\n            var suffix = '';\n            var exists = false;\n\n            if(!item){\n                throw new TypeError('A item is required to generate a unique identifier');\n            }\n\n            usedIds   = item.getUsedIds();\n\n            do{\n                exists = false;\n                id = prefix + suffix;\n                if(_.contains(usedIds, id)){\n                    exists = true;\n                    suffix = '_' + i;\n                    i++;\n                }\n            } while(exists);\n\n            return id;\n        },\n\n        /**\n         * Generates an identifier for a Qti element\n         * @param {Object} item - the element related item\n         * @param {String} prefix - identifier prefix\n         * @param {Boolean} [useSuffix = true] - add a \"_ + index\" to the identifier\n         * @returns {String} the identifier\n         * @throws {TypeError} if there is no item\n         */\n        buildIdentifier : function buildIdentifier(item, prefix, useSuffix){\n\n            var id;\n            var usedIds;\n            var suffix = '';\n            var i = 1;\n            var exists = false;\n\n            if(!item){\n                throw new TypeError('A item is required to generate a unique identifier');\n            }\n\n            if(!prefix){\n                throw new TypeError('Prefix is required to build an identifier');\n            }\n\n            usedIds   = item.getUsedIdentifiers();\n            useSuffix = _.isUndefined(useSuffix) ? true : useSuffix;\n\n            if(prefix){\n                prefix = prefix.replace(/_[0-9]+$/ig, '_') //detect incremental id of type choice_12, response_3, etc.\n                               .replace(/[^a-zA-Z0-9_]/ig, '_')\n                               .replace(/(_)+/ig, '_');\n                if(useSuffix){\n                    suffix = '_' + i;\n                }\n            }\n\n            do{\n                exists = false;\n                id = prefix + suffix;\n                if(usedIds[id]){\n                    exists = true;\n                    suffix = '_' + i;\n                    i++;\n                }\n            } while(exists);\n\n            return id;\n        },\n\n        findInCollection : function findInCollection(element, collectionNames, searchedSerial){\n\n            var found = null;\n\n            if(_.isString(collectionNames)){\n                collectionNames = [collectionNames];\n            }\n\n            if(_.isArray(collectionNames)){\n\n                _.each(collectionNames, function(collectionName){\n\n                    //get collection to search in (resolving case like interaction.choices.0\n                    var collection = element;\n                    _.each(collectionName.split('.'), function(nameToken){\n                        collection = collection[nameToken];\n                    });\n                    var elt = collection[searchedSerial];\n\n                    if(elt){\n                        found = {'parent' : element, 'element' : elt};\n                        return false;//break the each loop\n                    }\n\n                    //search inside each elements:\n                    _.each(collection, function(elt){\n\n                        if(_.isFunction(elt.find)){\n                            found = elt.find(searchedSerial);\n                            if(found){\n                                return false;//break the each loop\n                            }\n                        }\n\n                    });\n\n                    if(found){\n                        return false;//break the each loop\n                    }\n\n                });\n\n            }else{\n\n                throw new Error('invalid argument : collectionNames must be an array or a string');\n            }\n\n            return found;\n        },\n        addMarkupNamespace : function addMarkupNamespace(markup, ns){\n            if(ns) {\n                markup = markup.replace(/<(\\/)?([a-z:]+)(\\s?)([^><]*)>/g, function($0, $1, $2, $3, $4){\n                    if($2.indexOf(':')>0){\n                        return $0;\n                    }\n                    $1 = $1 || '';\n                    $3 = $3 || '';\n                    return '<'+ $1 + ns + ':'+$2+$3+$4+'>';\n                });\n                return markup;\n            }\n            return markup;\n\n        },\n        removeMarkupNamespaces : function removeMarkupNamespace(markup){\n            return markup.replace(/<(\\/)?(\\w*):([^>]*)>/g, '<$1$3>');\n        },\n        getMarkupUsedNamespaces : function getMarkupUsedNamespaces(markup){\n            var namespaces = [];\n            markup.replace(/<(\\/)?(\\w*):([^>]*)>/g, function(original, slash, ns, node){\n                namespaces.push(ns);\n                return '<'+slash+node+'>';\n            });\n            return _.uniq(namespaces);\n        }\n    };\n\n    return util;\n});\n\n","define('taoQtiItem/qtiItem/helper/rendererConfig',['lodash', 'jquery'], function(_, $){\n\n    var rendererConfigHelper = {};\n\n    rendererConfigHelper.getOptionsFromArguments = function(args){\n\n        var options = {\n            data : {},\n            placeholder : null,\n            subclass : '',\n            renderer : null\n        };\n        \n        _.each(args, function(arg){\n            if(arg){\n                if(arg.isRenderer){\n                    options.renderer = arg;\n                }else if(arg instanceof $ && arg.length){\n                    options.placeholder = arg;\n                }else if(_.isString(arg)){\n                    options.subclass = arg;\n                }else if(_.isPlainObject(arg)){\n                    options.data = arg;\n                }else{\n                    console.log('invalid arg', arg, args);\n                }\n            }\n        });\n        \n        return options;\n    };\n    \n    return rendererConfigHelper;\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA\n *\n */\ndefine('taoQtiItem/qtiItem/core/Element',[\n    'jquery',\n    'lodash',\n    'class',\n    'core/logger',\n    'taoQtiItem/qtiItem/helper/util',\n    'taoQtiItem/qtiItem/helper/rendererConfig'\n], function($, _, Class, loggerFactory, util, rendererConfig){\n    'use strict';\n\n    var _instances = {};\n\n    /**\n     * Create a logger\n     */\n    var logger = loggerFactory('taoQtiItem/qtiItem/core/Element');\n\n    var Element = Class.extend({\n        qtiClass : '',\n        serial : '',\n        rootElement : null,\n        init : function(serial, attributes){\n\n            //init own attributes\n            this.attributes = {};\n\n            //system properties, for item creator internal use only\n            this.metaData = {};\n\n            //init call in the format init(attributes)\n            if(typeof (serial) === 'object'){\n                attributes = serial;\n                serial = '';\n            }\n\n            if(!serial){\n                serial = util.buildSerial(this.qtiClass + '_');\n            }\n\n            if(serial && (typeof serial !== 'string' || !serial.match(/^[a-z_0-9]*$/i))){\n                throw 'invalid QTI serial : (' + (typeof serial) + ') ' + serial;\n            }\n\n            if(!_instances[serial]){\n                _instances[serial] = this;\n                this.serial = serial;\n                this.setAttributes(attributes || {});\n            }else{\n                throw 'a QTI Element with the same serial already exists ' + serial;\n            }\n\n            if(typeof this.initContainer === 'function'){\n                this.initContainer(arguments[2] || '');\n            }\n            if(typeof this.initObject === 'function'){\n                this.initObject();\n            }\n        },\n        is : function(qtiClass){\n            return (qtiClass === this.qtiClass);\n        },\n        placeholder : function(){\n            return '{{' + this.serial + '}}';\n        },\n        getSerial : function(){\n            return this.serial;\n        },\n        getUsedIdentifiers : function(){\n            var usedIds = {};\n            var elts = this.getComposingElements();\n            for(var i in elts){\n                var elt = elts[i];\n                var id = elt.attr('identifier');\n                if(id){\n                    //warning: simplistic implementation, allow only one unique identifier in the item no matter the element class/type\n                    usedIds[id] = elt;\n                }\n            }\n            return usedIds;\n        },\n\n        /**\n         * Get the ids in use. (id is different from identifier)\n         * @returns {Array} of the ids in use\n         */\n        getUsedIds : function getUsedIds(){\n            var usedIds = [];\n            _.forEach(this.getComposingElements(), function(elt){\n                var id = elt.attr('id');\n                if(id && !_.contains(usedIds, id)){\n                    usedIds.push(id);\n                }\n            });\n            return usedIds;\n        },\n\n        attr : function(name, value){\n            if(name){\n                if(value !== undefined){\n                    this.attributes[name] = value;\n                }else{\n                    if(typeof (name) === 'object'){\n                        for(var prop in name){\n                            this.attr(prop, name[prop]);\n                        }\n                    }else if(typeof (name) === 'string'){\n                        if(this.attributes[name] === undefined){\n                            return undefined;\n                        }else{\n                            return this.attributes[name];\n                        }\n                    }\n                }\n            }\n            return this;\n        },\n        data : function(name, value){\n            if(name){\n                if(value !== undefined){\n                    this.metaData[name] = value;\n                    $(document).trigger('metaChange.qti-widget', {element : this, key : name, value : value});\n                }else{\n                    if(typeof (name) === 'object'){\n                        for(var prop in name){\n                            this.data(prop, name[prop]);\n                        }\n                    }else if(typeof (name) === 'string'){\n                        if(this.metaData[name] === undefined){\n                            return undefined;\n                        }else{\n                            return this.metaData[name];\n                        }\n                    }\n                }\n            }\n            return this;\n        },\n        removeData : function(name){\n            delete this.metaData[name];\n            return this;\n        },\n        removeAttr : function(name){\n            return this.removeAttributes(name);\n        },\n        setAttributes : function(attributes){\n            this.attributes = attributes;\n            return this;\n        },\n        getAttributes : function(){\n            return _.clone(this.attributes);\n        },\n        removeAttributes : function(attrNames){\n            if(typeof (attrNames) === 'string'){\n                attrNames = [attrNames];\n            }\n            for(var i in attrNames){\n                delete this.attributes[attrNames[i]];\n            }\n            return this;\n        },\n        getComposingElements : function(){\n            var elts = {};\n            function append(element){\n                elts[element.getSerial()] = element;//pass individual object by ref, instead of the whole list(object)\n                elts = _.extend(elts, element.getComposingElements());\n            }\n            if(typeof this.initContainer === 'function'){\n                append(this.getBody());\n            }\n            if(typeof this.initObject === 'function'){\n                append(this.getObject());\n            }\n            _.each(this.metaData, function(v){\n                if(Element.isA(v, '_container')){\n                    append(v);\n                }else if(_.isArray(v)){\n                    _.each(v, function(v){\n                        if(Element.isA(v, '_container')){\n                            append(v);\n                        }\n                    });\n                }\n            });\n            return elts;\n        },\n        getUsedClasses : function(){\n\n            var ret = [this.qtiClass],\n                composingElts = this.getComposingElements();\n\n            _.each(composingElts, function(elt){\n                ret.push(elt.qtiClass);\n            });\n\n            return _.uniq(ret);\n        },\n        find : function(serial){\n\n            var found = null;\n\n            if(typeof this.initObject === 'function'){\n                var object = this.getObject();\n                if(object.serial === serial){\n                    found = {'parent' : this, 'element' : object, 'location' : 'object'};\n                }\n            }\n\n            if(!found && typeof this.initContainer === 'function'){\n                found = this.getBody().find(serial, this);\n            }\n\n            return found;\n        },\n        parent : function(){\n            var item = this.getRootElement();\n            if(item){\n                var found = item.find(this.getSerial());\n                if(found){\n                    return found.parent;\n                }\n            }\n            return null;\n        },\n        /**\n         * @deprecated - use setRootElement() instead\n         */\n        setRelatedItem : function(item) {\n            logger.warn('Deprecated use of setRelatedItem()');\n            this.setRootElement(item);\n        },\n        setRootElement : function(item){\n            var composingElts,\n                i;\n\n            if(Element.isA(item, 'assessmentItem')){\n                this.rootElement = item;\n                composingElts = this.getComposingElements();\n                for(i in composingElts){\n                    composingElts[i].setRootElement(item);\n                }\n            }\n\n        },\n        /**\n         * @deprecated - use getRootElement() instead\n         */\n        getRelatedItem : function(){\n            logger.warn('Deprecated use of getRelatedItem()');\n            return this.getRootElement();\n        },\n        getRootElement : function(){\n            var ret = null;\n            if(Element.isA(this.rootElement, 'assessmentItem')){\n                ret = this.rootElement;\n            }\n            return ret;\n        },\n        setRenderer : function(renderer){\n            if(renderer && renderer.isRenderer){\n                this.renderer = renderer;\n                var elts = this.getComposingElements();\n                for(var serial in elts){\n                    elts[serial].setRenderer(renderer);\n                }\n            }else{\n                throw 'invalid qti rendering engine';\n            }\n        },\n        getRenderer : function(){\n            return this.renderer;\n        },\n        render : function(){\n\n            var args = rendererConfig.getOptionsFromArguments(arguments);\n            var _renderer = args.renderer || this.getRenderer();\n\n            var tplData = {},\n                defaultData = {\n                    'tag' : this.qtiClass,\n                    'serial' : this.serial,\n                    'attributes' : this.getAttributes()\n                };\n\n            if(!_renderer){\n                throw 'render: no renderer found for the element ' + this.qtiClass + ':' + this.serial;\n            }\n\n            if(typeof this.initContainer === 'function'){\n                //allow body to have a different renderer if it has its own renderer set\n                defaultData.body = this.getBody().render(args.renderer);\n            }\n            if(typeof this.initObject === 'function'){\n                defaultData.object = {\n                    attributes : this.object.getAttributes()\n                };\n                defaultData.object.attributes.data = _renderer.resolveUrl(this.object.attr('data'));\n            }\n\n            tplData = _.merge(defaultData, args.data || {});\n            tplData = _renderer.getData(this, tplData, args.subclass);\n            var rendering = _renderer.renderTpl(this, tplData, args.subclass);\n            if(args.placeholder){\n                args.placeholder.replaceWith(rendering);\n            }\n\n            return rendering;\n        },\n        postRender : function(data, altClassName, renderer){\n\n            var postRenderers = [];\n            var _renderer = renderer || this.getRenderer();\n\n            if(typeof this.initContainer === 'function'){\n                //allow body to have a different renderer if it has its own renderer set\n                postRenderers = this.getBody().postRender(data, '', renderer);\n            }\n\n            if(_renderer){\n                postRenderers.push(_renderer.postRender(this, data, altClassName));\n            }else{\n                throw 'postRender: no renderer found for the element ' + this.qtiClass + ':' + this.serial;\n            }\n\n            return _.compact(postRenderers);\n        },\n        getContainer : function($scope, subclass){\n            var renderer = this.getRenderer();\n            if(renderer){\n                return renderer.getContainer(this, $scope, subclass);\n            }else{\n                throw 'getContainer: no renderer found for the element ' + this.qtiClass + ':' + this.serial;\n            }\n        },\n        toArray : function(){\n            var arr = {\n                serial : this.serial,\n                type : this.qtiClass,\n                attributes : this.getAttributes()\n            };\n\n            if(typeof this.initContainer === 'function'){\n                arr.body = this.getBody().toArray();\n            }\n            if(typeof this.initObject === 'function'){\n                arr.object = this.object.toArray();\n            }\n\n            return arr;\n        },\n        isEmpty : function(){\n            //tells whether the element should be considered empty or not, from the rendering point of view\n            return false;\n        },\n        addClass : function(className){\n            var clazz = this.attr('class') || '';\n            if(!_containClass(clazz, className)){\n                this.attr('class', clazz + (clazz.length ? ' ' : '') + className);\n            }\n        },\n        hasClass : function(className){\n            return _containClass(this.attr('class'), className);\n        },\n        removeClass : function(className){\n\n            var clazz = this.attr('class') || '';\n            if(clazz){\n\n                var regex = new RegExp('(?:^|\\\\s)' + className + '(?:\\\\s|$)');\n                clazz = clazz.replace(regex, ' ').trim();\n\n                if(clazz){\n                    this.attr('class', clazz);\n                }else{\n                    this.removeAttr('class');\n                }\n            }\n        },\n        /**\n         * Add or remove class. Setting the optional state will force addition/removal.\n         * State is here to keep the jQuery syntax\n         *\n         * @param {String} className\n         * @param {Boolean} [state]\n         */\n        toggleClass : function(className, state) {\n\n            if(typeof state === 'boolean') {\n                return state ? this.addClass(className) : this.removeClass(className);\n            }\n\n            if(this.hasClass(className)) {\n                return this.removeClass(className);\n            }\n            return this.addClass(className);\n        },\n        isset : function(){\n            return Element.issetElement(this.serial);\n        },\n        unset : function(){\n            return Element.unsetElement(this.serial);\n        }\n    });\n\n    var _containClass = function(allClassStr, className){\n        var regex = new RegExp('(?:^|\\\\s)' + className + '(?:\\\\s|$)', '');\n        return allClassStr && regex.test(allClassStr);\n    };\n\n    //helpers\n    Element.isA = function(qtiElement, qtiClass){\n        return (qtiElement instanceof Element && qtiElement.is(qtiClass));\n    };\n\n    Element.getElementBySerial = function(serial){\n        return _instances[serial];\n    };\n\n    Element.issetElement = function(serial){\n        return !!_instances[serial];\n    };\n\n    /**\n     * Unset a registered element from it's serial\n     * @param {String} serial - the element serial\n     * @returns {Boolean} true if unset\n     */\n    Element.unsetElement = function(serial){\n\n        var element = Element.getElementBySerial(serial);\n\n        if(element){\n\n            var composingElements = element.getComposingElements();\n            _.each(composingElements, function(elt){\n                delete _instances[elt.serial];\n            });\n            delete _instances[element.serial];\n\n            return true;\n        }\n        return false;\n    };\n\n    return Element;\n});\n\n\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA ;\n *\n */\n//@todo : move this to the ../helper directory\ndefine('taoQtiItem/qtiItem/core/Loader',['lodash', 'class', 'taoQtiItem/qtiItem/core/qtiClasses', 'taoQtiItem/qtiItem/core/Element'], function(_, Class, qtiClasses, Element){\n\n    var Loader = Class.extend({\n        init : function(item, classesLocation){\n\n            this.qti = {}; //loaded qti classes are store here\n            this.classesLocation = {};\n\n            this.item = item || null;//starts either from scratch or with an existing item object\n            this.setClassesLocation(classesLocation || qtiClasses);//load default location for qti classes model\n        },\n        setClassesLocation : function(qtiClasses){\n            _.extend(this.classesLocation, qtiClasses);\n            return this;\n        },\n        getRequiredClasses : function(data){\n            var ret = [];\n            for(var i in data){\n                if(i === 'qtiClass' && data[i] !== '_container' && i !== 'rootElement'){//although a _container is a concrete class in TAO, it is not defined in QTI standard\n                    ret.push(data[i]);\n                }else if(typeof(data[i]) === 'object' && i !== 'responseRules'){    //responseRules should'nt be part of the parsing\n                    ret = _.union(ret, this.getRequiredClasses(data[i]));\n                }\n            }\n            return ret;\n        },\n        loadRequiredClasses : function(data, callback, reload){\n\n            var requiredClasses = this.getRequiredClasses(data, reload), required = [];\n\n            for(var i in requiredClasses){\n                var requiredClass = requiredClasses[i];\n                if(this.classesLocation[requiredClass]){\n                    required.push(this.classesLocation[requiredClass]);\n                }else{\n                    throw new Error('missing qti class location declaration : ' + requiredClass);\n                }\n            }\n\n            var _this = this;\n            require(required, function(){\n                _.each(arguments, function(QtiClass){\n                    _this.qti[QtiClass.prototype.qtiClass] = QtiClass;\n                });\n                callback.call(_this, _this.qti);\n            });\n        },\n        getLoadedClasses : function(){\n            return _.keys(this.qti);\n        },\n        loadItemData : function(data, callback){\n\n            var _this = this;\n            _this.loadRequiredClasses(data, function(Qti){\n                var i;\n                if(typeof(data) === 'object' && data.qtiClass === 'assessmentItem'){\n\n                    //unload an item from it's serial (in case of a reload)\n                    if(data.serial){\n                        Element.unsetElement(data.serial);\n                    }\n\n                    _this.item = new Qti.assessmentItem(data.serial, data.attributes || {});\n                    _this.loadContainer(_this.item.getBody(), data.body);\n\n                    for(i in data.outcomes){\n                        var outcome = _this.buildOutcome(data.outcomes[i]);\n                        if(outcome){\n                            _this.item.addOutcomeDeclaration(outcome);\n                        }\n                    }\n                    for(i in data.feedbacks){\n                        var feedback = _this.buildElement(data.feedbacks[i]);\n                        if(feedback){\n                            _this.item.addModalFeedback(feedback);\n                        }\n                    }\n                    for(i in data.stylesheets){\n                        var stylesheet = _this.buildElement(data.stylesheets[i]);\n                        if(stylesheet){\n                            _this.item.addStylesheet(stylesheet);\n                        }\n                    }\n\n                    //important : build responses after all modal feedbacks and outcomes has been loaded, because the simple feedback rules need to reference them\n                    for(i in data.responses){\n                        var response = _this.buildResponse(data.responses[i]);\n                        if(response){\n                            _this.item.addResponseDeclaration(response);\n\n                            var feedbackRules = data.responses[i].feedbackRules;\n                            if(feedbackRules){\n                                _.forIn(feedbackRules, function(fbData, serial){\n                                    response.feedbackRules[serial] = _this.buildSimpleFeedbackRule(fbData, response);\n                                });\n                            }\n                        }\n                    }\n\n                    if(data.responseProcessing){\n                        _this.item.setResponseProcessing(_this.buildResponseProcessing(data.responseProcessing));\n                    }\n                    _this.item.setNamespaces(data.namespaces);\n                    _this.item.setSchemaLocations(data.schemaLocations);\n                    _this.item.setApipAccessibility(data.apipAccessibility);\n                }\n\n                if(typeof(callback) === 'function'){\n                    callback.call(_this, _this.item);\n                }\n            });\n        },\n        loadAndBuildElement : function(data, callback){\n\n            var _this = this;\n\n            _this.loadRequiredClasses(data, function(Qti){\n\n                var element = _this.buildElement(data);\n\n                if(typeof(callback) === 'function'){\n                    callback.call(_this, element);\n                }\n            });\n        },\n        loadElement : function(element, data, callback){\n\n            var _this = this;\n            this.loadRequiredClasses(data, function(){\n                _this.loadElementData(element, data);\n                if(typeof(callback) === 'function'){\n                    callback.call(_this, element);\n                }\n            });\n        },\n        /**\n         * Load ALL given elements into existing loaded item\n         *\n         * @todo to be renamed to loadItemElements\n         * @param {object} data\n         * @param {function} callback\n         * @returns {undefined}\n         */\n        loadElements : function(data, callback){\n\n            var _this = this;\n\n            if(_this.item){\n\n                this.loadRequiredClasses(data, function(){\n\n                    var allElements = _this.item.getComposingElements();\n\n                    for(var i in data){\n                        var elementData = data[i];\n                        if(elementData && elementData.qtiClass && elementData.serial){\n                            //find and update element\n                            if(allElements[elementData.serial]){\n                                _this.loadElementData(allElements[elementData.serial], elementData);\n                            }\n                        }\n                    }\n\n                    if(typeof(callback) === 'function'){\n                        callback.call(_this, _this.item);\n                    }\n                });\n            }else{\n                throw 'QtiLoader : cannot load elements in empty item';\n            }\n\n        },\n        buildResponse : function(data){\n\n            var response = this.buildElement(data);\n\n            response.template = data.howMatch || null;\n            response.defaultValue = data.defaultValue || null;\n            response.correctResponse = data.correctResponses || null;\n\n            if(_.size(data.mapping)){\n                response.mapEntries = data.mapping;\n            }else if(_.size(data.areaMapping)){\n                response.mapEntries = data.areaMapping;\n            }else{\n                response.mapEntries = {};\n            }\n\n            response.mappingAttributes = data.mappingAttributes || {};\n\n            return response;\n        },\n        buildSimpleFeedbackRule : function(data, response){\n\n            var feedbackRule = this.buildElement(data);\n\n            feedbackRule.setCondition(response, data.condition, data.comparedValue || null);\n\n//            feedbackRule.comparedOutcome = this.item.responses[data.comparedOutcome] || null;\n            feedbackRule.feedbackOutcome = this.item.outcomes[data.feedbackOutcome] || null;\n            feedbackRule.feedbackThen = this.item.modalFeedbacks[data.feedbackThen] || null;\n            feedbackRule.feedbackElse = this.item.modalFeedbacks[data.feedbackElse] || null;\n\n            //associate the compared outcome to the feedbacks if applicable\n            var response = feedbackRule.comparedOutcome;\n            if(feedbackRule.feedbackThen){\n                feedbackRule.feedbackThen.data('relatedResponse', response);\n            }\n            if(feedbackRule.feedbackElse){\n                feedbackRule.feedbackElse.data('relatedResponse', response);\n            }\n\n            return feedbackRule;\n        },\n        buildOutcome : function(data){\n            var outcome = this.buildElement(data);\n            outcome.defaultValue = data.defaultValue || null;\n            return outcome;\n        },\n        buildResponseProcessing : function(data){\n            var rp = this.buildElement(data);\n            if(data && data.processingType){\n                if(data.processingType === 'custom'){\n                    rp.xml = data.data;\n                    rp.processingType = 'custom';\n                }else{\n                    rp.processingType = 'templateDriven';\n                }\n            }\n            return rp;\n        },\n        loadContainer : function(bodyObject, bodyData){\n            if(!Element.isA(bodyObject, '_container')){\n                throw 'bodyObject must be a QTI Container';\n            }\n\n            if(bodyData && typeof bodyData.body === 'string' && (typeof bodyData.elements === 'array' || typeof bodyData.elements === 'object')){\n                for(var serial in bodyData.elements){\n                    var eltData = bodyData.elements[serial];\n                    //check if class is loaded:\n                    var element = this.buildElement(eltData);\n                    if(element){\n                        bodyObject.setElement(element, bodyData.body);\n                    }\n                }\n                bodyObject.body(bodyData.body);\n            }else{\n                throw 'wrong bodydata format';\n            }\n        },\n        buildElement : function(elementData){\n            var elt = null;\n            if(elementData && elementData.qtiClass && elementData.serial){\n                var className = elementData.qtiClass;\n                if(this.qti[className]){\n                    elt = new this.qti[className](elementData.serial);\n                    this.loadElementData(elt, elementData);\n                }else{\n                    throw 'the qti element class does not exist: ' + className;\n                }\n            }else{\n                throw 'wrong elementData format';\n            }\n            return elt;\n        },\n        loadElementData : function(element, data){\n\n            //merge attributes when loading element data\n            var attributes = _.defaults(data.attributes || {}, element.attributes || {});\n            element.setAttributes(attributes);\n\n            if(element.body && data.body){\n                if(element.bdy){\n                    this.loadContainer(element.getBody(), data.body);\n                }\n            }\n\n            if(element.object && data.object){\n                if(element.object){\n                    this.loadObjectData(element.object, data.object);\n                }\n            }\n\n            if(Element.isA(element, 'interaction')){\n                this.loadInteractionData(element, data);\n            }else if(Element.isA(element, 'choice')){\n                this.loadChoiceData(element, data);\n            }else if(Element.isA(element, 'math')){\n                this.loadMathData(element, data);\n            }else if(Element.isA(element, 'infoControl')){\n                this.loadPicData(element, data);\n            }\n\n            return element;\n        },\n        loadInteractionData : function(interaction, data){\n            if(Element.isA(interaction, 'blockInteraction')){\n                if(data.prompt){\n                    this.loadContainer(interaction.prompt.getBody(), data.prompt);\n                }\n            }\n\n            this.buildInteractionChoices(interaction, data);\n\n            if(Element.isA(interaction, 'customInteraction')){\n                this.loadPciData(interaction, data);\n            }\n        },\n        buildInteractionChoices : function(interaction, data){\n\n            //note: Qti.ContainerInteraction (Qti.GapMatchInteraction and Qti.HottextInteraction) has already been parsed by builtElement(interacionData);\n            if(data.choices){\n                if(Element.isA(interaction, 'matchInteraction')){\n                    for(var set = 0; set < 2; set++){\n                        if(!data.choices[set]){\n                            throw 'missing match set #' + set;\n                        }\n                        var matchSet = data.choices[set];\n                        for(var serial in matchSet){\n                            var choice = this.buildElement(matchSet[serial]);\n                            if(choice){\n                                interaction.addChoice(choice, set);\n                            }\n                        }\n                    }\n                }else{\n                    for(var serial in data.choices){\n                        var choice = this.buildElement(data.choices[serial]);\n                        if(choice){\n                            interaction.addChoice(choice);\n                        }\n                    }\n                }\n\n                if(Element.isA(interaction, 'graphicGapMatchInteraction')){\n                    if(data.gapImgs){\n                        for(var serial in data.gapImgs){\n                            var gapImg = this.buildElement(data.gapImgs[serial]);\n                            if(gapImg){\n                                interaction.addGapImg(gapImg);\n                            }\n                        }\n                    }\n                }\n\n            }\n\n        },\n        loadChoiceData : function(choice, data){\n            if(Element.isA(choice, 'textVariableChoice')){\n                choice.val(data.text);\n            }else if(Element.isA(choice, 'gapImg')){\n                //has already been taken care of in buildElement()\n            }else if(Element.isA(choice, 'gapText')){\n                // this ensure compatibility of Qti 2.1 items\n                if (! choice.body()) {\n                    choice.body(data.text);\n                }\n            }else if(Element.isA(choice, 'containerChoice')){\n                //has already been taken care of in buildElement()\n            }\n        },\n        loadObjectData : function(object, data){\n            object.setAttributes(data.attributes);\n            //@todo: manage object like a container\n            if(data._alt){\n                if(data._alt.qtiClass === 'object'){\n                    object._alt = Loader.buildElement(data._alt);\n                }else{\n                    object._alt = data._alt;\n                }\n            }\n        },\n        loadMathData : function(math, data){\n            math.ns = data.ns || {};\n            math.setMathML(data.mathML || '');\n            _.forIn(data.annotations || {}, function(value, encoding){\n                math.setAnnotation(encoding, value);\n            });\n        },\n        loadPciData : function(pci, data){\n            loadPortableCustomElementData(pci, data);\n        },\n        loadPicData : function(pic, data){\n            loadPortableCustomElementData(pic, data);\n        }\n    });\n\n    function loadPortableCustomElementData(portableElement, data){\n        portableElement.typeIdentifier = data.typeIdentifier;\n        portableElement.markup = data.markup;\n        portableElement.entryPoint = data.entryPoint;\n        portableElement.properties = data.properties;\n        portableElement.libraries = data.libraries;\n    }\n\n    return Loader;\n});\n\n","/**\n * Common helper functions\n */\ndefine('taoQtiItem/qtiItem/helper/interactionHelper',['lodash', 'taoQtiItem/qtiItem/core/Element'], function(_, Element){\n    return {\n        convertChoices : function(choices, outputType){\n\n            var ret = [], _this = this;\n\n            _.each(choices, function(c){\n                if(Element.isA(c, 'choice')){\n                    switch(outputType){\n                        case 'serial':\n                            ret.push(c.getSerial());\n                            break;\n                        case 'identifier':\n                            ret.push(c.id());\n                            break;\n                        default:\n                            ret.push(c);\n                    }\n\n                }else if(_.isArray(c)){\n                    ret.push(_this.convertChoices(c, outputType));\n                }\n            });\n\n            return ret;\n        },\n        findChoices : function(interaction, choices, inputType){\n\n            var ret = [], _this = this;\n\n            _.each(choices, function(c){\n                var choice;\n                if(_.isString(c)){\n                    if(inputType === 'serial'){\n                        choice = interaction.getChoice(c);\n                        if(choice){\n                            ret.push(choice);\n                        }\n                    }else if(inputType === 'identifier'){\n                        choice = interaction.getChoiceByIdentifier(c);\n                        if(choice){\n                            ret.push(choice);\n                        }\n                    }else{\n                        ret.push(c);\n                    }\n                }else if(_.isArray(c)){\n                    ret.push(_this.findChoices(interaction, c, inputType));\n                }else{\n                    ret.push(c);\n                }\n            });\n\n            return ret;\n        },\n        shuffleChoices : function(choices){\n            var r = [], //returned array\n                f = {}, //fixed choices array\n                j = 0;\n\n            for(var i in choices){\n                if(Element.isA(choices[i], 'choice')){\n                    var choice = choices[i];\n                    if(choice.attr('fixed')){\n                        f[j] = choice;\n                    }\n                    r.push(choice);\n                    j++;\n                }else{\n                    throw 'invalid element in array: is not a qti choice';\n                }\n            }\n\n            for(var n = 0; n < r.length - 1; n++){\n                if(f[n]){\n                    continue;\n                }\n                var k = -1;\n                do{\n                    k = n + Math.floor(Math.random() * (r.length - n));\n                }while(f[k]);\n                var tmp = r[k];\n                r[k] = r[n];\n                r[n] = tmp;\n            }\n\n            return r;\n        },\n        serialToIdentifier : function(interaction, choiceSerial){\n            var choice = interaction.getChoice(choiceSerial);\n            if(choice){\n                return choice.id();\n            }else{\n                return '';\n            }\n        }\n    }\n});\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014 (original work) Open Assessment Technlogies SA (under the project TAO-PRODUCT);\n *\n */\n\n/**\n * A factory to create a QTI renderer.\n *\n * @author Sam Sipasseuth <sam@taotesting.com>\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\ndefine('taoQtiItem/qtiRunner/core/Renderer',[\n    'lodash',\n    'jquery',\n    'handlebars',\n    'core/promise',\n    'taoQtiItem/qtiItem/core/Element',\n    'taoQtiItem/qtiItem/helper/interactionHelper',\n    'ui/themeLoader'\n], function(_, $, Handlebars, Promise, Element, interactionHelper, themeLoader){\n    'use strict';\n\n    var _isValidRenderer = function(renderer){\n\n        var valid = true;\n\n        if(typeof (renderer) !== 'object'){\n            return false;\n        }\n\n        var classCorrect = false;\n        if(renderer.qtiClass){\n            if(_.indexOf(_renderableClasses, renderer.qtiClass) >= 0){\n                classCorrect = true;\n            }else{\n                var pos = renderer.qtiClass.indexOf('.');\n                if(pos > 0){\n                    var qtiClass = renderer.qtiClass.slice(0, pos);\n                    var subClass = renderer.qtiClass.slice(pos + 1);\n                    if(_renderableSubclasses[qtiClass] && _.indexOf(_renderableSubclasses[qtiClass], subClass) >= 0){\n                        classCorrect = true;\n                    }\n                }\n            }\n        }\n        if(!classCorrect){\n            valid = false;\n            throw new Error('invalid qti class name in renderer declaration : ' + renderer.qtiClass);\n        }\n\n        if(!renderer.template){\n            valid = false;\n            throw new Error('missing template in renderer declaration : ' + renderer.qtiClass);\n        }\n\n        return valid;\n    };\n\n    var _renderableClasses = [\n        '_container',\n        'assessmentItem',\n        'stylesheet',\n        'responseDeclaration',\n        'outcomeDeclaration',\n        'responseProcessing',\n        '_simpleFeedbackRule',\n        'img',\n        'math',\n        'object',\n        'table',\n        'modalFeedback',\n        'rubricBlock',\n        'associateInteraction',\n        'choiceInteraction',\n        'extendedTextInteraction',\n        'gapMatchInteraction',\n        'graphicAssociateInteraction',\n        'graphicGapMatchInteraction',\n        'graphicOrderInteraction',\n        'hotspotInteraction',\n        'hottextInteraction',\n        'inlineChoiceInteraction',\n        'matchInteraction',\n        'mediaInteraction',\n        'orderInteraction',\n        'selectPointInteraction',\n        'sliderInteraction',\n        'textEntryInteraction',\n        'uploadInteraction',\n        'endAttemptInteraction',\n        'customInteraction',\n        'prompt',\n        'associableHotspot',\n        'gap',\n        'gapImg',\n        'gapText',\n        'hotspotChoice',\n        'hottext',\n        'inlineChoice',\n        'simpleAssociableChoice',\n        'simpleChoice',\n        'infoControl',\n        'include'\n    ];\n\n    /**\n     * The list of qti element dependencies. It is used internally to load dependent qti classes\n     */\n    var _dependencies = {\n        assessmentItem : ['stylesheet', '_container', 'prompt', 'modalFeedback'],\n        rubricBlock : ['_container'],\n        associateInteraction : ['simpleAssociableChoice'],\n        choiceInteraction : ['simpleChoice'],\n        gapMatchInteraction : ['gap', 'gapText'],\n        graphicAssociateInteraction : ['associableHotspot'],\n        graphicGapMatchInteraction : ['associableHotspot', 'gapImg'],\n        graphicOrderInteraction : ['hotspotChoice'],\n        hotspotInteraction : ['hotspotChoice'],\n        hottextInteraction : ['hottext'],\n        inlineChoiceInteraction : ['inlineChoice'],\n        matchInteraction : ['simpleAssociableChoice'],\n        orderInteraction : ['simpleChoice']\n    };\n\n    /**\n     * The list of supported qti subclasses.\n     */\n    var _renderableSubclasses = {\n        'simpleAssociableChoice' : ['associateInteraction', 'matchInteraction'],\n        'simpleChoice' : ['choiceInteraction', 'orderInteraction']\n    };\n\n    /**\n     * List of the default properties for the item\n     */\n    var _defaults = {\n        shuffleChoices : true\n    };\n\n    /**\n     * Get the location of the document, useful to define a baseUrl for the required context\n     * @returns {String}\n     */\n    function getDocumentBaseUrl(){\n        return window.location.protocol + '//' + window.location.host + window.location.pathname.replace(/([^\\/]*)$/, '');\n    }\n\n    /**\n     * The built Renderer class\n     * @constructor\n     * @param {Object} [options] - the renderer options\n     * @param {AssetManager} [options.assetManager] - The renderer needs an AssetManager to resolve URLs (see {@link taoItems/assets/manager})\n     * @param {Boolean} [options.shuffleChoices = true] - Does the renderer take care of the shuffling\n     * @param {Object} [options.decorators] - to set up rendering decorator\n     * @param {preRenderDecorator} [options.decorators.before] - to set up a pre decorator\n     * @param {postRenderDecorator} [options.decorators.after] - to set up a post decorator\n     */\n    var Renderer = function(options){\n\n        /**\n         * Store the registered renderer location\n         */\n        var _locations = {};\n\n        /**\n         * Store loaded renderers\n         */\n        var _renderers = {};\n\n        options = _.defaults(options || {}, _defaults);\n\n        this.isRenderer = true;\n\n        this.name = '';\n\n        //store shuffled choice here\n        this.shuffledChoices = [];\n\n        /**\n         * Get the actual renderer of the give qti class or subclass:\n         * e.g. simplceChoice, simpleChoice.choiceInteraction, simpleChoice.orderInteraction\n         */\n        var _getClassRenderer = function(qtiClass){\n            var ret = null;\n            if(_renderers[qtiClass]){\n                ret = _renderers[qtiClass];\n            }else{\n                var pos = qtiClass.indexOf('.');\n                if(pos > 0){\n                    qtiClass = qtiClass.slice(0, pos);\n                    if(_renderers[qtiClass]){\n                        ret = _renderers[qtiClass];\n                    }\n                }\n            }\n            return ret;\n        };\n\n        /**\n         * Registers a QTI renderer class\n         * @param {String} qtiClass\n         * @param {Array} list\n         * @returns {Boolean} `true` if the class has been successfully registered\n         */\n        function registerRendererClass(qtiClass, list) {\n            var success = false;\n            if (_locations[qtiClass] === false) {\n                //mark this class as not renderable\n                _renderers[qtiClass] = false;\n                success = true;\n            } else if (_locations[qtiClass]) {\n                list.push(_locations[qtiClass]);\n                success = true;\n            }\n            return success;\n        }\n\n        /**\n         * Set the renderer options\n         * @param {String} key - the name of the option\n         * @param {*} value - the option vallue\n         * @returns {Renderer} for chaining\n         */\n        this.setOption = function(key, value){\n            if(typeof (key) === 'string'){\n                options[key] = value;\n            }\n            return this;\n        };\n\n        /**\n         * Set the renderer options\n         * @param {Object} opts - the options\n         * @returns {Renderer} for chaining\n         */\n        this.setOptions = function(opts){\n            options = _.extend(options, opts);\n            return this;\n        };\n\n        /**\n         * Get the renderer option\n         * @param {String} key - the name of the option\n         * @returns {*|null} the option vallue\n         */\n        this.getOption = function(key){\n            if(typeof (key) === 'string' && options[key]){\n                return options[key];\n            }\n            return null;\n        };\n\n        this.getCustomMessage = function getCustomMessage(elementName, messageKey){\n            var messages = this.getOption('messages');\n            if(messages &&\n                elementName &&\n                messages[elementName] &&\n                _.isString(messages[elementName][messageKey])){\n                //currently not translatable but potentially could be if the need raises\n                return Handlebars.compile(messages[elementName][messageKey]);\n            }else{\n                return null;\n            }\n        };\n\n        /**\n         * Get the bound assetManager\n         * @returns {AssetManager} the assetManager\n         */\n        this.getAssetManager = function getAssetManager(){\n            return options.assetManager;\n        };\n\n        /**\n         * Get the bound theme loader\n         * @returns {Object} the themeLoader\n         */\n        this.getThemeLoader = function getThemeLoader(){\n            return this.themeLoader;\n        };\n\n\n        /**\n         * Renders the template\n         * @param {Object} element - the QTI model element\n         * @param {Object} data - the data to give to the template\n         * @param {String} [qtiSubclass] - to get the render of the element subclass (when element's qtiClass is abstract)\n         * @returns {String} the template results\n         * @throws {Error} if the renderer is not set or has no template bound\n         */\n        this.renderTpl = function(element, data, qtiSubclass){\n\n            var res;\n            var ret        = '';\n            var tplFound   = false;\n            var qtiClass   = qtiSubclass || element.qtiClass;\n            var renderer   = _getClassRenderer(qtiClass);\n            var decorators = this.getOption('decorators');\n\n            if(!renderer || !_.isFunction(renderer.template)){\n                throw new Error('no renderer template loaded under the class name : ' + qtiClass);\n            }\n\n            //pre rendering decoration\n            if(_.isObject(decorators) && _.isFunction(decorators.before)){\n\n                /**\n                 * @callback preRenderDecoractor\n                 * @param {Object} element - the QTI model element\n                 * @param {String} [qtiSubclass] - to get the render of the element subclass (when element's qtiClass is abstract)\n                 * @returns {String} the decorator result\n                 */\n                res = decorators.before(element, qtiSubclass);\n                if(_.isString(res)){\n                    ret += res;\n                }\n            }\n\n            //render the template\n            ret += renderer.template(data);\n\n\n            //post rendering decoration\n            if(_.isObject(decorators) && _.isFunction(decorators.after)){\n\n                /**\n                 * @callback postRenderDecoractor\n                 * @param {Object} element - the QTI model element\n                 * @param {String} [qtiSubclass] - to get the render of the element subclass (when element's qtiClass is abstract)\n                 * @returns {String} the decorator result\n                 */\n                res = decorators.after(element, qtiSubclass);\n                if(_.isString(res)){\n                    ret += res;\n                }\n            }\n            return ret;\n        };\n\n        this.getData = function(element, data, qtiSubclass){\n\n            var ret = data,\n                qtiClass = qtiSubclass || element.qtiClass,\n                renderer = _getClassRenderer(qtiClass);\n\n            if(renderer){\n                if(typeof (renderer.getData) === 'function'){\n                    ret = renderer.getData.call(this, element, data);\n                }\n            }\n\n            return ret;\n        };\n\n        this.renderDirect = function(tpl, data){\n            return Handlebars.compile(tpl)(data);\n        };\n\n        this.getContainer = function(qtiElement, $scope, qtiSubclass){\n\n            var ret = null,\n                qtiClass = qtiSubclass || qtiElement.qtiClass,\n                renderer = _getClassRenderer(qtiClass);\n\n            if(renderer){\n                ret = renderer.getContainer(qtiElement, $scope);\n            }else{\n                throw 'no renderer found for the class : ' + qtiElement.qtiClass;\n            }\n            return ret;\n        };\n\n        this.postRender = function(qtiElement, data, qtiSubclass){\n\n            var qtiClass = qtiSubclass || qtiElement.qtiClass;\n            var renderer = _getClassRenderer(qtiClass);\n\n            if(renderer && typeof (renderer.render) === 'function') {\n                return renderer.render.call(this, qtiElement, data);\n            }\n        };\n\n        this.setResponse = function(qtiInteraction, response, qtiSubclass){\n\n            var ret = false,\n                qtiClass = qtiSubclass || qtiInteraction.qtiClass,\n                renderer = _getClassRenderer(qtiClass);\n\n            if(renderer){\n                if(typeof (renderer.setResponse) === 'function'){\n                    ret = renderer.setResponse.call(this, qtiInteraction, response);\n                    var $container = renderer.getContainer.call(this, qtiInteraction);\n                    if($container instanceof $ && $container.length){\n                        $container.trigger('responseSet', [qtiInteraction, response]);\n                    }\n                }\n            }else{\n                throw 'no renderer registered under the name : ' + qtiClass;\n            }\n            return ret;\n        };\n\n        this.getResponse = function(qtiInteraction, qtiSubclass){\n\n            var ret = false,\n                qtiClass = qtiSubclass || qtiInteraction.qtiClass,\n                renderer = _getClassRenderer(qtiClass);\n\n            if(renderer){\n                if(typeof (renderer.getResponse) === 'function'){\n                    ret = renderer.getResponse.call(this, qtiInteraction);\n                }\n            }else{\n                throw 'no renderer registered under the name : ' + qtiClass;\n            }\n            return ret;\n        };\n\n        this.resetResponse = function(qtiInteraction, qtiSubclass){\n\n            var ret = false,\n                qtiClass = qtiSubclass || qtiInteraction.qtiClass,\n                renderer = _getClassRenderer(qtiClass);\n\n            if(renderer){\n                if(typeof (renderer.resetResponse) === 'function'){\n                    ret = renderer.resetResponse.call(this, qtiInteraction);\n                }\n            }else{\n                throw 'no renderer registered under the name : ' + qtiClass;\n            }\n            return ret;\n        };\n\n        /**\n         * Retrieve the state of the interaction.\n         * If the renderer has no state management, it falls back to the response management.\n         *\n         * @param {Object} qtiInteraction - the interaction\n         * @param {String} [qtiSubClass] - (not sure of the type and how it is used - Sam ? )\n         * @returns {Object} the interaction's state\n         *\n         * @throws {Error} if no renderer is registered\n         */\n        this.getState = function(qtiInteraction, qtiSubclass){\n\n            var ret = false;\n            var qtiClass = qtiSubclass || qtiInteraction.qtiClass;\n            var renderer = _getClassRenderer(qtiClass);\n\n            if(renderer){\n                if(_.isFunction(renderer.getState)){\n                    ret = renderer.getState.call(this, qtiInteraction);\n                } else {\n                    ret = renderer.getResponse.call(this, qtiInteraction);\n                }\n            }else{\n                throw 'no renderer registered under the name : ' + qtiClass;\n            }\n            return ret;\n        };\n\n        /**\n         * Retrieve the state of the interaction.\n         * If the renderer has no state management, it falls back to the response management.\n         *\n         * @param {Object} qtiInteraction - the interaction\n         * @param {Object} state - the interaction's state\n         * @param {String} [qtiSubClass] - (not sure of the type and how it is used - Sam ? )\n         *\n         * @throws {Error} if no renderer is found\n         */\n        this.setState =  function(qtiInteraction, state, qtiSubclass){\n\n            var qtiClass = qtiSubclass || qtiInteraction.qtiClass;\n            var renderer = _getClassRenderer(qtiClass);\n\n            if(renderer){\n                if(_.isFunction(renderer.setState)){\n                    renderer.setState.call(this, qtiInteraction, state);\n                } else {\n                    renderer.resetResponse.call(this, qtiInteraction);\n                    renderer.setResponse.call(this, qtiInteraction, state);\n                }\n            }else{\n                throw 'no renderer registered under the name : ' + qtiClass;\n            }\n        };\n\n        /**\n         * Calls the renderer destroy.\n         * Ask the renderer to run destroy if exists.\n         *\n         * @throws {Error} if no renderer is found\n         */\n        this.destroy = function(qtiInteraction, qtiSubclass){\n\n            var ret = false,\n                qtiClass = qtiSubclass || qtiInteraction.qtiClass,\n                renderer = _getClassRenderer(qtiClass);\n\n            if(renderer){\n                if(_.isFunction(renderer.destroy)){\n                    ret = renderer.destroy.call(this, qtiInteraction);\n                }\n            }else{\n                throw 'no renderer registered under the name : ' + qtiClass;\n            }\n            return ret;\n        };\n\n        this.getLoadedRenderers = function(){\n            return _renderers;\n        };\n\n        this.register = function(renderersLocations){\n            _.extend(_locations, renderersLocations);\n        };\n\n        this.load = function(callback, requiredClasses){\n           var self = this;\n            var required = [];\n\n            if(options.themes){\n\n                //resolve themes paths\n                options.themes.base = this.resolveUrl(options.themes.base);\n                _.forEach(options.themes.available, function(theme, index){\n                    options.themes.available[index].path = self.resolveUrl(theme.path);\n                });\n                this.themeLoader = themeLoader(options.themes).load();\n            }\n\n            if(requiredClasses){\n                if(_.isArray(requiredClasses)){\n\n                    //exclude abstract classes\n                    requiredClasses = _.intersection(requiredClasses, _renderableClasses);\n\n                    //add dependencies\n                    _.each(requiredClasses, function(reqClass){\n                        var deps = _dependencies[reqClass];\n                        if(deps){\n                            requiredClasses = _.union(requiredClasses, deps);\n                        }\n                    });\n\n                    _.forEach(requiredClasses, function(qtiClass){\n\n                        if(_renderableSubclasses[qtiClass]){\n                            var requiredSubClasses = _.intersection(requiredClasses, _renderableSubclasses[qtiClass]);\n                            _.each(requiredSubClasses, function(subclass){\n                                if (!registerRendererClass(qtiClass + '.' + subclass, required) && !registerRendererClass(qtiClass, required)) {\n                                    throw new Error(self.name + ' : missing qti class location declaration: ' + qtiClass + ', subclass: ' + subclass);\n                                }\n                            });\n                        } else {\n                            if (!registerRendererClass(qtiClass, required)) {\n                                throw new Error(self.name + ' : missing qti class location declaration: ' + qtiClass);\n                            }\n                        }\n                    });\n                } else {\n                    throw new Error('invalid argument type: expected array for arg \"requireClasses\"');\n                }\n\n            }else{\n                required = _.values(_locations);\n            }\n\n            var _this = this;\n            require(required, function(){\n\n                _.each(arguments, function(clazz){\n                    if(_isValidRenderer(clazz)){\n                        _renderers[clazz.qtiClass] = clazz;\n                    }\n                });\n\n                if(typeof (callback) === 'function'){\n                    callback.call(_this, _renderers);\n                }\n            });\n\n            return this;\n        };\n\n        /**\n         * Unload the renderer\n         */\n        this.unload = function unload(){\n            if(this.themeLoader){\n                themeLoader(options.themes).unload();\n            }\n            return this;\n        };\n\n        /**\n         * Define the shuffling manually\n         *\n         * @param {Object} interaction - the interaction\n         * @param {Array} choices - the shuffled choices\n         * @param {String} identificationType -\n         */\n        this.setShuffledChoices = function(interaction, choices, identificationType){\n            if(Element.isA(interaction, 'interaction')){\n                this.shuffledChoices[interaction.getSerial()] = _.pluck(interactionHelper.findChoices(interaction, choices, identificationType), 'serial');\n            }\n        };\n\n        /**\n         * Get the choices shuffled for this interaction.\n         *\n         * @param {Object} interaction - the interaction\n         * @param {Boolean} reshuffle - by default choices are shuffled only once and store, but if true you can force shuffling again\n         * @param {String} returnedType - the choice type\n         * @returns {Array} the choices\n         */\n        this.getShuffledChoices = function(interaction, reshuffle, returnedType){\n            var choices = [];\n            var shuffled = [];\n            var serial, i;\n\n            if(Element.isA(interaction, 'interaction')){\n                serial = interaction.getSerial();\n\n                //1st time, we shuffle (or asked to force shuffling)\n                if(!this.shuffledChoices[serial] || reshuffle){\n                    if(Element.isA(interaction, 'matchInteraction')){\n                        this.shuffledChoices[serial] = [];\n                        for(i = 0; i < 2; i++){\n                            choices[i] = interactionHelper.shuffleChoices(interaction.getChoices(i));\n                            this.shuffledChoices[serial][i] = _.pluck(choices[i], 'serial');\n                        }\n                    } else {\n                        choices = interactionHelper.shuffleChoices(interaction.getChoices());\n                        this.shuffledChoices[serial] = _.pluck(choices, 'serial');\n                    }\n\n                //otherwise get the choices from the serials\n                } else {\n                    if(Element.isA(interaction, 'matchInteraction')){\n                        _.forEach(choices, function(choice, index){\n                            if(index < 2){\n                                _.forEach(this.shuffledChoices[serial][i], function(choiceSerial){\n                                    choice.push(interaction.getChoice(choiceSerial));\n                                });\n                            }\n                        });\n                    } else {\n                        _.forEach(this.shuffledChoices[serial], function(choiceSerial){\n                            choices.push(interaction.getChoice(choiceSerial));\n                        });\n                    }\n                }\n\n                //do some type convertion\n                if(returnedType === 'serial' || returnedType === 'identifier'){\n                    return interactionHelper.convertChoices(choices, returnedType);\n                }\n\n                //pass value only, not ref\n                return _.clone(choices);\n            }\n\n            return [];\n        };\n\n        this.getRenderers = function(){\n            return _renderers;\n        };\n\n        this.getLocations = function(){\n            return _locations;\n        };\n\n        /**\n         * Resolve URLs using the defined assetManager's strategies\n         * @param {String} url - the URL to resolve\n         * @returns {String} the resolved URL\n         */\n        this.resolveUrl = function resolveUrl(url){\n            if(!options.assetManager){\n                return url;\n            }\n            if(typeof url === 'string' && url.length > 0){\n                return options.assetManager.resolve(url);\n            }\n        };\n\n        /**\n         * @deprecated in favor of resolveUrl\n         */\n        this.getAbsoluteUrl = function(relUrl){\n\n            //let until method is removed\n            console.warn('DEPRECATED used getAbsoluteUrl with ', arguments);\n\n            //allow relative url output only if explicitely said so\n            if(this.getOption('userRelativeUrl')){\n                return relUrl.replace(/^\\.?\\//, '');\n            }\n\n            if(/^http(s)?:\\/\\//i.test(relUrl) || /^data:[^\\/]+\\/[^;]+(;charset=[\\w]+)?;base64,/.test(relUrl)){\n                //already absolute or base64 encoded\n                return relUrl;\n            }else{\n\n                var absUrl = '';\n                var runtimeLocations = this.getOption('runtimeLocations');\n\n                if(runtimeLocations && _.size(runtimeLocations)){\n                    _.forIn(runtimeLocations, function(runtimeLocation, typeIdentifier){\n                        if(relUrl.indexOf(typeIdentifier) === 0){\n                            absUrl = relUrl.replace(typeIdentifier, runtimeLocation);\n                            return false;//break\n                        }\n                    });\n                }\n\n                if(absUrl){\n                    return absUrl;\n                }else{\n                    var baseUrl = this.getOption('baseUrl') || getDocumentBaseUrl();\n                    return baseUrl + relUrl;\n                }\n\n            }\n        };\n\n        this.setAreaBroker = function setAreaBroker(areaBroker) {\n            this._areaBroker = areaBroker;\n        };\n\n        this.getAreaBroker = function getAreaBroker() {\n            if (this._areaBroker) {\n                return this._areaBroker;\n            }\n        };\n    };\n\n    /**\n     * Expose the renderer's factory\n     * @exports taoQtiItem/qtiRunner/core/Renderer\n     */\n    return {\n\n        /**\n         * Creates a new Renderer by extending the Renderer's prototype\n         * @param {Object} renderersLocations -\n         * @param {String} [name] - the new renderer name\n         * @param {Object} [defaultOptions] - the renderer options\n         */\n        build : function(renderersLocations, name, defaultOptions){\n            var NewRenderer = function(){\n                var options = _.isPlainObject(arguments[0]) ? arguments[0] : {};\n\n                Renderer.apply(this);\n\n                this.register(renderersLocations);\n                this.name = name || '';\n                this.setOptions(_.defaults(options, defaultOptions || {}));\n            };\n            NewRenderer.prototype = Renderer.prototype;\n            return NewRenderer;\n        }\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA ;\n */\n/**\n * @author Jean-Sébastien Conan <jean-sebastien.conan@vesperiagroup.com>\n */\ndefine('taoQtiItem/runner/provider/manager/picManager',[\n    'jquery',\n    'lodash',\n    'taoQtiItem/qtiItem/core/Element'\n], function ($, _, Element) {\n    'use strict';\n\n    /**\n     * The template of a PicManager instance\n     * @type {picManager}\n     */\n    var picManager = {\n        /**\n         * Creates a manager for a particular PIC\n         *\n         * @param {Object} pic\n         * @param {QtiItem} item\n         * @returns {picManager}\n         */\n        init : function init(pic, item) {\n            if (Element.isA(pic, 'infoControl')) {\n                this._pic = pic;\n            }\n\n            if (Element.isA(item, 'assessmentItem')) {\n                this._item = item;\n            }\n\n            return this;\n        },\n\n        /**\n         * Gets the managed PIC\n         *\n         * @returns {Object} the descriptor of the PIC\n         */\n        getPic : function getPic() {\n            return this._pic;\n        },\n\n        /**\n         * Gets the related Item\n         *\n         * @returns {QtiItem} the Item\n         */\n        getItem : function getItem() {\n            return this._item;\n        },\n\n        /**\n         * Gets the PIC serial\n         * @returns {String}\n         */\n        getSerial : function getSerial() {\n            return this._pic && this._pic.serial;\n        },\n\n        /**\n         * Gets the PIC type identifier\n         * @returns {String}\n         */\n        getTypeIdentifier : function getTypeIdentifier() {\n            return this._pic && this._pic.typeIdentifier;\n        },\n\n        /**\n         * Gets the underlying DOM element of the managed PIC\n         * @returns {{pic: (jQuery), tool: (jQuery), button: (jQuery), broken: (Boolean))}|*} An object providing the underlying DOM elements of the PIC and its tool\n         */\n        getDom : function getDom() {\n            if (!this._dom) {\n                var serial = this.getSerial();\n                var pic, tool;\n\n                if (serial) {\n                    pic = $('[data-serial=\"' + serial + '\"]');\n                    if (pic.length) {\n                        tool = $('[data-pic-serial=\"' + serial + '\"]');\n\n                        if (!tool.length) {\n                            tool = pic.children().first();\n                        }\n\n                        this._dom = {\n                            pic : pic,\n                            tool : tool,\n                            button : tool.find('.sts-button'),\n                            broken : pic.is(':empty') // tells if the tool has been moved outside of the PIC\n                        };\n                    }\n                }\n            }\n\n            return this._dom;\n        },\n\n        /**\n         * Enables the PIC.\n         * @fires enable\n         * @returns {picManager}\n         */\n        enable : function enable() {\n            // @todo: find a better solution for disabling/enabling a PIC\n            var dom = this.getDom();\n            if (dom) {\n                // just remove the disabled state and destroy the disable mask\n                dom.button.removeClass('disabled');\n                dom.tool.find('.sts-button-disable-mask').remove();\n\n                this.disabled = false;\n                this.trigger('enable');\n            }\n\n            return this;\n        },\n\n        /**\n         * Disables the PIC\n         * @fires disable\n         * @returns {picManager}\n         */\n        disable : function disable() {\n            // @todo: find a better solution for disabling/enabling a PIC\n            var dom = this.getDom();\n            var button;\n            if (dom) {\n                // set a disabled state by adding a CSS class, then mask the button with a top-level element\n                button = dom.button.addClass('disabled');\n\n                $('<div class=\"sts-button-disable-mask\" style=\"position:absolute;z-index:10000000000000\"></div>')\n                    .appendTo(dom.tool)\n                    .offset(button.offset())\n                    .width(button.outerWidth())\n                    .height(button.outerHeight());\n\n                // also hide any sub component\n                dom.tool.find('.sts-container, .sts-menu-container').addClass('sts-hidden-container');\n\n                this.disabled = true;\n                this.trigger('disable');\n            }\n\n            return this;\n        },\n\n        /**\n         * Shows the PIC\n         * @fires show\n         * @returns {picManager}\n         */\n        show : function show() {\n            var dom = this.getDom();\n            if (dom) {\n                dom.tool.show();\n\n                this.trigger('show');\n            }\n\n            return this;\n        },\n\n        /**\n         * Hides the PIC\n         * @fires hide\n         * @returns {picManager}\n         */\n        hide : function hide() {\n            var dom = this.getDom();\n            if (dom) {\n                dom.tool.hide();\n\n                this.trigger('hide');\n            }\n\n            return this;\n        },\n\n        /**\n         * Triggers an event on the underlying DOM element\n         * @param {String} eventName\n         * @returns {picManager}\n         */\n        trigger : function trigger(eventName) {\n            var dom = this.getDom();\n            var args = _.rest(arguments, 1);\n\n            args.unshift(this);\n\n            if (dom) {\n                // trigger the event, if the tool has been moved outside of the PIC, trigger also the event on the PIC\n                dom.tool.trigger(eventName, args);\n                if (dom.broken) {\n                    dom.pic.trigger(eventName, args);\n                }\n            }\n\n            return this;\n        }\n    };\n\n    /**\n     * The template of a PicManagerCollection instance\n     * @type {picManagerCollection}\n     */\n    var picManagerCollection = {\n        /**\n         * Creates the collection of PIC from an Item\n         *\n         * @param {QtiItem} item\n         * @returns {picManagerCollection}\n         */\n        init : function init(item) {\n            if (Element.isA(item, 'assessmentItem')) {\n                this._item = item;\n            }\n\n            return this;\n        },\n\n        /**\n         * Gets the list of PIC managers for the PIC provided by the running item.\n         *\n         * @param {Boolean} [force] Force a list rebuild\n         * @returns {Array} Returns the list of managers for the provided PIC\n         */\n        getList : function getList(force) {\n            var self = this;\n\n            // build the list if empty\n            if (force || !self._list) {\n                self._map = {};\n                self._list = [];\n                if (self._item) {\n                    _.forEach(self._item.getElements(), function(element) {\n                        var manager;\n\n                        if (Element.isA(element, 'infoControl')) {\n                            manager = managerFactory(element, self._item);\n                            self._list.push(manager);\n                            self._map[element.serial] = manager;\n                            self._map[element.typeIdentifier] = manager;\n                        }\n                    });\n                }\n            }\n\n            return this._list;\n        },\n\n        /**\n         * Gets the manager of the first PIC matching the identifier from the list provided by the running item.\n         *\n         * @param {String} picId The PIC typeIdentifier or serial\n         * @returns {Object} The manager of the PIC\n         */\n        getPic : function getPic(picId) {\n            this.getList();\n            return this._map[picId];\n        },\n\n        /**\n         * Executes an action on a particular PIC from the running item.\n         * @param {String} picId The PIC typeIdentifier or serial\n         * @param {String} action The name of the action to call\n         * @returns {*} Returns the action result\n         */\n        execute : function execute(picId, action) {\n            var pic = this.getPic(picId);\n            if (pic && pic[action]) {\n                return pic[action].apply(pic, _.rest(arguments, 2));\n            }\n        },\n\n        /**\n         * Executes an action on each PIC provided by the running item.\n         * @param {String} action The name of the action to call\n         * @param {Function} [filter] An optional filter to reduce the list\n         * @returns {picManagerCollection}\n         */\n        executeAll : function executeAll(action, filter) {\n            var args = _.rest(arguments, 2);\n            var cb;\n\n            if (typeof filter === 'function') {\n                cb = function(pic) {\n                    if (filter.call(pic, pic) && pic[action]) {\n                        pic[action].apply(pic, args);\n                    }\n                };\n            } else {\n                cb = function(pic) {\n                    if (pic[action]) {\n                        pic[action].apply(pic, args);\n                    }\n                };\n            }\n\n            return this.each(cb);\n        },\n\n        /**\n         * Calls a callback function on each listed PIC from the running item.\n         * @param {Function} cb The callback function to apply on each listed PIC\n         * @returns {picManagerCollection}\n         */\n        each : function each(cb) {\n            _.forEach(this.getList(), cb);\n            return this;\n        },\n\n        /**\n         * Enables a PIC provided by the running item.\n         *\n         * @param {String} picId The PIC typeIdentifier or serial\n         * @returns {picManagerCollection}\n         */\n        enablePic : function enablePic(picId) {\n            this.execute(picId, 'enable');\n            return this;\n        },\n\n        /**\n         * Disables a PIC provided by the running item.\n         *\n         * @param {String} picId The PIC typeIdentifier or serial\n         * @returns {picManagerCollection}\n         */\n        disablePic : function disablePic(picId) {\n            this.execute(picId, 'disable');\n            return this;\n        },\n\n        /**\n         * Shows a PIC provided by the running item.\n         *\n         * @param {String} picId The PIC typeIdentifier or serial\n         * @returns {picManagerCollection}\n         */\n        showPic : function showPic(picId) {\n            this.execute(picId, 'show');\n            return this;\n        },\n\n        /**\n         * Hides a PIC provided by the running item.\n         *\n         * @param {String} picId The PIC typeIdentifier or serial\n         * @returns {picManagerCollection}\n         */\n        hidePic : function hidePic(picId) {\n            this.execute(picId, 'hide');\n            return this;\n        },\n\n        /**\n         * Enables all PIC provided by the running item.\n         *\n         * @param {Function} [filter] An optional filter to reduce the list of PIC to enable\n         * @returns {picManagerCollection}\n         */\n        enableAll : function enableAll(filter) {\n            this.executeAll('enable', filter);\n            return this;\n        },\n\n        /**\n         * Disables all PIC provided by the running item.\n         *\n         * @param {Function} [filter] An optional filter to reduce the list of PIC to disable\n         * @returns {picManagerCollection}\n         */\n        disableAll : function disableAll(filter) {\n            this.executeAll('disable', filter);\n            return this;\n        },\n\n        /**\n         * Shows all PIC provided by the running item.\n         *\n         * @param {Function} [filter] An optional filter to reduce the list of PIC to show\n         * @returns {picManagerCollection}\n         */\n        showAll : function showAll(filter) {\n            this.executeAll('show', filter);\n            return this;\n        },\n\n        /**\n         * Hides all PIC provided by the running item.\n         *\n         * @param {Function} [filter] An optional filter to reduce the list of PIC to hide\n         * @returns {picManagerCollection}\n         */\n        hideAll : function hideAll(filter) {\n            this.executeAll('hide', filter);\n            return this;\n        }\n    };\n\n    /**\n     * Creates a PIC manager for a particular Item.\n     * @param {Object} pic\n     * @param {QtiItem} item\n     * @returns {picManager} Returns the instance of the PIC manager\n     */\n    var managerFactory = function managerFactory(pic, item) {\n        var manager = _.clone(picManager, true);\n        return manager.init(pic, item);\n    };\n\n    /**\n     * Creates a PIC manager for a particular Item.\n     * @param {QtiItem} item\n     * @returns {picManager} Returns the instance of the PIC manager\n     */\n    var collectionFactory = function collectionFactory(item) {\n        var collection = _.clone(picManagerCollection, true);\n        return collection.init(item);\n    };\n\n    return {\n        collection: collectionFactory,\n        manager: managerFactory\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA ;\n */\n/**\n * @author Christophe Noël <christophe@taotesting.com>\n */\ndefine('taoQtiItem/runner/provider/manager/userModules',[\n    'lodash',\n    'module',\n    'core/promise'\n], function (_, module, Promise) {\n    'use strict';\n\n    return {\n        /**\n         * Load user modules defined in the module config\n         * @param {Array} [userModules] - manually specify user modules to load instead of getting them from the module config\n         * @returns {Promise}\n         */\n        load: function load(userModules) {\n            var config = module.config();\n\n            if (! userModules || ! _.isArray(userModules)) {\n                if (config && config.userModules && _.isArray(config.userModules)) {\n                    userModules = config.userModules;\n                } else {\n                    userModules = [];\n                }\n            }\n            return new Promise(function(resolve, reject) {\n                require(\n                    userModules,\n                    function () {\n                        _.forEach(arguments, function (dependency) {\n                            if (dependency && _.isFunction(dependency.exec)) {\n                                dependency.exec();\n                            }\n                        });\n                        resolve();\n                    },\n                    function (err) {\n                        reject(err.message);\n                    }\n                );\n            });\n        }\n    };\n});\n\n","\ndefine('tpl!taoQtiPrint/qtiPrintRenderer/tpl/notYetSupported', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, functionType=\"function\", self=this;\n\nfunction program1(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"\\n    <div class=\\\"additional\\\">\\n        <div class=\\\"title\\\">Additional information:</div>\\n        <p class=\\\"info\\\">\";\n  if (helper = helpers.additional) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.additional); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"</p>\\n    </div>\\n\";\n  return buffer;\n  }\n\n  buffer += \"<article class=\\\"render-error feedback-error\\\">\\n    <span class=\\\"icon-error\\\"></span>\\n    <p class=\\\"message\\\">\";\n  if (helper = helpers.message) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.message); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"</p>\\n\";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.additional), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n</article>\\n\";\n  return buffer;\n  });\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014-2017 (original work) Open Assessment Technlogies SA (under the project TAO-PRODUCT);\n */\n\n/**\n * Item Runner for printed items\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\ndefine('taoQtiPrint/runner/provider/qtiprint',[\n    'lodash',\n    'i18n',\n    'context',\n    'core/logger',\n    'core/promise',\n    'taoQtiItem/qtiItem/core/Loader',\n    'taoQtiItem/qtiItem/core/Element',\n    'taoQtiItem/qtiRunner/core/Renderer',\n    'taoQtiItem/runner/provider/manager/picManager',\n    'taoQtiItem/runner/provider/manager/userModules',\n    'tpl!taoQtiPrint/qtiPrintRenderer/tpl/notYetSupported'\n], function (_, __, context, loggerFactory, Promise, QtiLoader, Element, Renderer, picManager, userModules, notYetSupportedTpl) {\n    'use strict';\n\n    var timeout = (context.timeout > 0 ? context.timeout + 1 : 30) * 1000;\n\n    var logger = loggerFactory('runner/provider/qtiPrint');\n\n    /**\n     * List the renderer's modules\n     * @type Object\n     */\n    var rendererModules = {\n        results: ['taoQtiPrint/qtiCommonRenderer/renderers/config', 'css!taoQtiPrintCss/themes/items/default/theme.css'],\n        booklet: ['taoQtiPrint/qtiPrintRenderer/renderers/config', 'css!taoQtiPrintCss/qti.css'],\n        bubbleSheet: ['taoQtiPrint/qtiPrintRenderer/renderers/config', 'css!taoQtiPrintCss/themes/items/bubble-sheet/theme.css']\n    };\n\n    /**\n     * The promise that resolves the chosen renderer\n     * @type {Promise}\n     */\n    var QtiRendererPromise = null;\n\n    /**\n     * Gets a promise that will resolve the chosen renderer\n     * @param {String} rendererType The name of the renderer to resolve\n     * @returns {Promise}\n     */\n    function getQtiRenderer(rendererType) {\n        if (!QtiRendererPromise) {\n            QtiRendererPromise = new Promise(function (resolve) {\n                require(rendererModules[rendererType], function (config) {\n                    resolve(Renderer.build(config.locations, config.name, config.options));\n                });\n            }).catch(function (err) {\n                logger.error(err);\n            });\n        }\n        return QtiRendererPromise;\n    }\n\n    /**\n     * Gets a block that displays information about unsupported content\n     * @param {Object} item\n     * @param {Object} additional\n     * @returns {String}\n     */\n    function missingSupport(item, additional) {\n        var label = item.identifier;\n        if (item.attributes && item.attributes.label) {\n            label = item.attributes.label;\n        }\n        return notYetSupportedTpl({\n            message: __(\"The item &laquo;%s&raquo; contains an interaction that is not yet supported for printing purpose\", label),\n            additional: additional\n        });\n    }\n\n    /**\n     * @exports taoQtiPrint/runner/provider/qtiprint\n     */\n    return {\n        /**\n         *\n         * @param {Object} itemData\n         * @param {Function} done\n         */\n        init: function init(itemData, done) {\n            var self = this;\n\n            getQtiRenderer(self.options.renderer).then(function (QtiRenderer) {\n                var rendererOptions = {\n                    assetManager: self.assetManager\n                };\n\n                if (self.options.themes) {\n                    rendererOptions.themes = self.options.themes;\n                }\n\n                self._loader = new QtiLoader();\n                self._renderer = new QtiRenderer(rendererOptions);\n\n                self._loader.loadItemData(itemData, function (item) {\n                    if (!item) {\n                        return self.trigger('error', 'Unable to load item from the given data.');\n                    }\n\n                    self._itemData = itemData;\n                    self._item = item;\n                    try {\n                        self._renderer.load(function () {\n                            self._item.setRenderer(this);\n\n                            done();\n                        }, this.getLoadedClasses());\n                    } catch (e) {\n                        self.trigger('error', 'Unable to render the item : ' + e);\n                    }\n                });\n            });\n        },\n\n        /**\n         *\n         * @param {HTMLElement} elt\n         * @param {Function} done\n         */\n        render: function render(elt, done) {\n            var self = this;\n            if (this._item) {\n                try {\n                    if(this.options.showResponseIdentifier){\n                        this._item.addClass('show-response-identifier');\n                    }\n                    elt.innerHTML = this._item.render({});\n                } catch (e) {\n                    logger.trace(e);\n                    elt.innerHTML = missingSupport(this._itemData, e);\n                    self.trigger('warning', 'Error in template rendering : ' + e);\n                }\n                try {\n                    // Race between postRendering and timeout\n                    // postRendering waits for everything to be resolved or one reject\n                    Promise\n                        .race([\n                            Promise.all(this._item.postRender()),\n                            new Promise(function (resolve, reject) {\n                                _.delay(reject, timeout, new Error('Post rendering ran out of time in item ' + self._itemData.serial));\n                            })\n                        ])\n                        .then(function () {\n                            /**\n                             * Lists the PIC provided by this item.\n                             * @event qti#listpic\n                             */\n                            self.trigger('listpic', picManager.collection(self._item));\n\n                            return userModules.load().then(done);\n                        })\n                        .catch(function (err) {\n                            self.trigger('error', 'Error in post rendering : ' + err instanceof Error ? err.message : err);\n                            done();\n                        });\n\n                } catch (e) {\n                    self.trigger('error', 'Error in post rendering : ' + e);\n                    done();\n                }\n            } else {\n                done();\n            }\n        },\n\n        /**\n         *\n         * @param {HTMLElement} elt\n         * @param {Function} done\n         */\n        clear: function clear(elt, done) {\n            done();\n        },\n\n        /**\n         *\n         * @returns {Object}\n         */\n        getState: function getState() {\n            return {};\n        },\n\n        /**\n         *\n         * @param {Object} state\n         */\n        setState: function setState(state) {\n            if (this._item && state) {\n\n                //set interaction state\n                _.forEach(this._item.getInteractions(), function (interaction) {\n                    var id = interaction.attr('responseIdentifier');\n                    if (id && state[id]) {\n                        interaction.setState(state[id]);\n                    }\n                });\n\n                //set info control state\n                if (state.pic) {\n                    _.forEach(this._item.getElements(), function (element) {\n                        if (Element.isA(element, 'infoControl') && state.pic[element.attr('id')]) {\n                            element.setState(state.pic[element.attr('id')]);\n                        }\n                    });\n                }\n            }\n        },\n\n        /**\n         *\n         * @returns {Array}\n         */\n        getResponses: function getResponses() {\n            return [];\n        }\n    };\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014 (original work) Open Assessment Technlogies SA (under the project TAO-PRODUCT);\n *\n */\n\n/**\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\ndefine('taoQtiPrint/runner/itemRunner',[\n    'taoItems/runner/api/itemRunner',\n    'taoQtiPrint/runner/provider/qtiprint'\n], function(itemRunner, qtiRuntimeProvider){\n    'use strict';\n\n    //register the QTI Provider\n    itemRunner.register('qtiprint', qtiRuntimeProvider);\n\n    /**\n     * Expose the itemRunner with the QTI provider registered\n     * @exports taoQtiPrint/runner/itemRunner\n     */\n    return itemRunner;\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA;\n *\n */\n\n/**\n * Provides common strategies to resolved assets\n * that may be used by any type of items.\n *\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\ndefine('taoItems/assets/strategies',[\n    'util/url'\n], function(urlUtil){\n    'use strict';\n\n    /**\n     * Prepend a base to an URL\n     * @param {Object} url - a parsed URL\n     * @param {String} base - the base to prepend\n     * @param {Boolean} [slashcat = false] - remove dots, double slashes, etc.\n     * @returns {String} the URL\n     */\n    var prependToUrl = function prependToUrl(url, base, slashcat){\n\n        //is slashcat we manage slash concact\n        if(slashcat === true){\n            return base.replace(/\\/$/, '') + '/' + url.directory.replace(/^\\.\\//, '').replace(/^\\//, '')\n                + encodeURIComponent(url.file.replace(/^\\.\\//, '').replace(/^\\//, ''));\n        }\n\n        return base + url.directory.replace(/^\\.?\\//, '') + encodeURIComponent(url.file.replace(/^\\.?\\//, ''));\n    };\n\n    /**\n     * Unrelated strategies accessible by there name.\n     * Remember to not use the whole object, but each one in an array since the order matters.\n     *\n     * @exports taoItems/assets/strategies\n     */\n    var strategies = {\n\n        //the baseUrl concats the baseUrl in data if the url is relative\n        baseUrl : {\n            name : 'baseUrl',\n            handle : function handleBaseUrl(url, data){\n                if(typeof data.baseUrl === 'string' && (urlUtil.isRelative(url)) ){\n                    return prependToUrl(url, data.baseUrl, data.slashcat);\n                }\n            }\n        },\n\n        //bust the cache for item CSS\n        itemCssNoCache : {\n            name : 'itemCssNoCache',\n            handle : function handleItemCss(url, data){\n                if(typeof data.baseUrl === 'string' && (urlUtil.isRelative(url)) && /\\.css$/.test(url.file)) {\n                    return urlUtil.build(prependToUrl(url, data.baseUrl, data.slashcat), { bust : Date.now() });\n                }\n            }\n        },\n\n        //absolute URL are just left intact\n        external : {\n            name : 'external',\n            handle : function handleExternal(url){\n                if(urlUtil.isAbsolute(url)){\n                    return url.toString();\n                }\n            }\n        },\n\n        //the base64 encoded resources are also left intact\n        base64 : {\n            name : 'base64',\n            handle : function handleB64(url){\n                if(urlUtil.isBase64(url)){\n                    return url.toString();\n                }\n            }\n        },\n\n        //special tao media protocol\n        taomedia : {\n            name : 'taomedia',\n            handle : function handleTaoMedia(url, data){\n                //either a baseUrl is given or if empty, taomedia resources are managed as relative resources\n                var baseUrl = data.baseUrl || './';\n                if( (typeof url === 'object' && url.protocol === 'taomedia') ||\n                    (/^taomedia:\\/\\//.test(url.toString())) ){\n                    return baseUrl + url.toString();\n                }\n            }\n        }\n    };\n    return strategies;\n});\n\n","/**\n * @fileoverview\n * - Using the 'QRCode for Javascript library'\n * - Fixed dataset of 'QRCode for Javascript library' for support full-spec.\n * - this library has no dependencies.\n * \n * @author davidshimjs\n * @see <a href=\"http://www.d-project.com/\" target=\"_blank\">http://www.d-project.com/</a>\n * @see <a href=\"http://jeromeetienne.github.com/jquery-qrcode/\" target=\"_blank\">http://jeromeetienne.github.com/jquery-qrcode/</a>\n */\n define('taoQtiPrint/lib/qrcode',[], function(){\nvar QRCode;\n\n\t//---------------------------------------------------------------------\n\t// QRCode for JavaScript\n\t//\n\t// Copyright (c) 2009 Kazuhiko Arase\n\t//\n\t// URL: http://www.d-project.com/\n\t//\n\t// Licensed under the MIT license:\n\t//   http://www.opensource.org/licenses/mit-license.php\n\t//\n\t// The word \"QR Code\" is registered trademark of \n\t// DENSO WAVE INCORPORATED\n\t//   http://www.denso-wave.com/qrcode/faqpatent-e.html\n\t//\n\t//---------------------------------------------------------------------\n\tfunction QR8bitByte(data) {\n\t\tthis.mode = QRMode.MODE_8BIT_BYTE;\n\t\tthis.data = data;\n\t\tthis.parsedData = [];\n\n\t\t// Added to support UTF-8 Characters\n\t\tfor (var i = 0, l = this.data.length; i < l; i++) {\n\t\t\tvar byteArray = [];\n\t\t\tvar code = this.data.charCodeAt(i);\n\n\t\t\tif (code > 0x10000) {\n\t\t\t\tbyteArray[0] = 0xF0 | ((code & 0x1C0000) >>> 18);\n\t\t\t\tbyteArray[1] = 0x80 | ((code & 0x3F000) >>> 12);\n\t\t\t\tbyteArray[2] = 0x80 | ((code & 0xFC0) >>> 6);\n\t\t\t\tbyteArray[3] = 0x80 | (code & 0x3F);\n\t\t\t} else if (code > 0x800) {\n\t\t\t\tbyteArray[0] = 0xE0 | ((code & 0xF000) >>> 12);\n\t\t\t\tbyteArray[1] = 0x80 | ((code & 0xFC0) >>> 6);\n\t\t\t\tbyteArray[2] = 0x80 | (code & 0x3F);\n\t\t\t} else if (code > 0x80) {\n\t\t\t\tbyteArray[0] = 0xC0 | ((code & 0x7C0) >>> 6);\n\t\t\t\tbyteArray[1] = 0x80 | (code & 0x3F);\n\t\t\t} else {\n\t\t\t\tbyteArray[0] = code;\n\t\t\t}\n\n\t\t\tthis.parsedData.push(byteArray);\n\t\t}\n\n\t\tthis.parsedData = Array.prototype.concat.apply([], this.parsedData);\n\n\t\tif (this.parsedData.length != this.data.length) {\n\t\t\tthis.parsedData.unshift(191);\n\t\t\tthis.parsedData.unshift(187);\n\t\t\tthis.parsedData.unshift(239);\n\t\t}\n\t}\n\n\tQR8bitByte.prototype = {\n\t\tgetLength: function (buffer) {\n\t\t\treturn this.parsedData.length;\n\t\t},\n\t\twrite: function (buffer) {\n\t\t\tfor (var i = 0, l = this.parsedData.length; i < l; i++) {\n\t\t\t\tbuffer.put(this.parsedData[i], 8);\n\t\t\t}\n\t\t}\n\t};\n\n\tfunction QRCodeModel(typeNumber, errorCorrectLevel) {\n\t\tthis.typeNumber = typeNumber;\n\t\tthis.errorCorrectLevel = errorCorrectLevel;\n\t\tthis.modules = null;\n\t\tthis.moduleCount = 0;\n\t\tthis.dataCache = null;\n\t\tthis.dataList = [];\n\t}\n\n\tQRCodeModel.prototype={addData:function(data){var newData=new QR8bitByte(data);this.dataList.push(newData);this.dataCache=null;},isDark:function(row,col){if(row<0||this.moduleCount<=row||col<0||this.moduleCount<=col){throw new Error(row+\",\"+col);}\n\treturn this.modules[row][col];},getModuleCount:function(){return this.moduleCount;},make:function(){this.makeImpl(false,this.getBestMaskPattern());},makeImpl:function(test,maskPattern){this.moduleCount=this.typeNumber*4+17;this.modules=new Array(this.moduleCount);for(var row=0;row<this.moduleCount;row++){this.modules[row]=new Array(this.moduleCount);for(var col=0;col<this.moduleCount;col++){this.modules[row][col]=null;}}\n\tthis.setupPositionProbePattern(0,0);this.setupPositionProbePattern(this.moduleCount-7,0);this.setupPositionProbePattern(0,this.moduleCount-7);this.setupPositionAdjustPattern();this.setupTimingPattern();this.setupTypeInfo(test,maskPattern);if(this.typeNumber>=7){this.setupTypeNumber(test);}\n\tif(this.dataCache==null){this.dataCache=QRCodeModel.createData(this.typeNumber,this.errorCorrectLevel,this.dataList);}\n\tthis.mapData(this.dataCache,maskPattern);},setupPositionProbePattern:function(row,col){for(var r=-1;r<=7;r++){if(row+r<=-1||this.moduleCount<=row+r)continue;for(var c=-1;c<=7;c++){if(col+c<=-1||this.moduleCount<=col+c)continue;if((0<=r&&r<=6&&(c==0||c==6))||(0<=c&&c<=6&&(r==0||r==6))||(2<=r&&r<=4&&2<=c&&c<=4)){this.modules[row+r][col+c]=true;}else{this.modules[row+r][col+c]=false;}}}},getBestMaskPattern:function(){var minLostPoint=0;var pattern=0;for(var i=0;i<8;i++){this.makeImpl(true,i);var lostPoint=QRUtil.getLostPoint(this);if(i==0||minLostPoint>lostPoint){minLostPoint=lostPoint;pattern=i;}}\n\treturn pattern;},createMovieClip:function(target_mc,instance_name,depth){var qr_mc=target_mc.createEmptyMovieClip(instance_name,depth);var cs=1;this.make();for(var row=0;row<this.modules.length;row++){var y=row*cs;for(var col=0;col<this.modules[row].length;col++){var x=col*cs;var dark=this.modules[row][col];if(dark){qr_mc.beginFill(0,100);qr_mc.moveTo(x,y);qr_mc.lineTo(x+cs,y);qr_mc.lineTo(x+cs,y+cs);qr_mc.lineTo(x,y+cs);qr_mc.endFill();}}}\n\treturn qr_mc;},setupTimingPattern:function(){for(var r=8;r<this.moduleCount-8;r++){if(this.modules[r][6]!=null){continue;}\n\tthis.modules[r][6]=(r%2==0);}\n\tfor(var c=8;c<this.moduleCount-8;c++){if(this.modules[6][c]!=null){continue;}\n\tthis.modules[6][c]=(c%2==0);}},setupPositionAdjustPattern:function(){var pos=QRUtil.getPatternPosition(this.typeNumber);for(var i=0;i<pos.length;i++){for(var j=0;j<pos.length;j++){var row=pos[i];var col=pos[j];if(this.modules[row][col]!=null){continue;}\n\tfor(var r=-2;r<=2;r++){for(var c=-2;c<=2;c++){if(r==-2||r==2||c==-2||c==2||(r==0&&c==0)){this.modules[row+r][col+c]=true;}else{this.modules[row+r][col+c]=false;}}}}}},setupTypeNumber:function(test){var bits=QRUtil.getBCHTypeNumber(this.typeNumber);for(var i=0;i<18;i++){var mod=(!test&&((bits>>i)&1)==1);this.modules[Math.floor(i/3)][i%3+this.moduleCount-8-3]=mod;}\n\tfor(var i=0;i<18;i++){var mod=(!test&&((bits>>i)&1)==1);this.modules[i%3+this.moduleCount-8-3][Math.floor(i/3)]=mod;}},setupTypeInfo:function(test,maskPattern){var data=(this.errorCorrectLevel<<3)|maskPattern;var bits=QRUtil.getBCHTypeInfo(data);for(var i=0;i<15;i++){var mod=(!test&&((bits>>i)&1)==1);if(i<6){this.modules[i][8]=mod;}else if(i<8){this.modules[i+1][8]=mod;}else{this.modules[this.moduleCount-15+i][8]=mod;}}\n\tfor(var i=0;i<15;i++){var mod=(!test&&((bits>>i)&1)==1);if(i<8){this.modules[8][this.moduleCount-i-1]=mod;}else if(i<9){this.modules[8][15-i-1+1]=mod;}else{this.modules[8][15-i-1]=mod;}}\n\tthis.modules[this.moduleCount-8][8]=(!test);},mapData:function(data,maskPattern){var inc=-1;var row=this.moduleCount-1;var bitIndex=7;var byteIndex=0;for(var col=this.moduleCount-1;col>0;col-=2){if(col==6)col--;while(true){for(var c=0;c<2;c++){if(this.modules[row][col-c]==null){var dark=false;if(byteIndex<data.length){dark=(((data[byteIndex]>>>bitIndex)&1)==1);}\n\tvar mask=QRUtil.getMask(maskPattern,row,col-c);if(mask){dark=!dark;}\n\tthis.modules[row][col-c]=dark;bitIndex--;if(bitIndex==-1){byteIndex++;bitIndex=7;}}}\n\trow+=inc;if(row<0||this.moduleCount<=row){row-=inc;inc=-inc;break;}}}}};QRCodeModel.PAD0=0xEC;QRCodeModel.PAD1=0x11;QRCodeModel.createData=function(typeNumber,errorCorrectLevel,dataList){var rsBlocks=QRRSBlock.getRSBlocks(typeNumber,errorCorrectLevel);var buffer=new QRBitBuffer();for(var i=0;i<dataList.length;i++){var data=dataList[i];buffer.put(data.mode,4);buffer.put(data.getLength(),QRUtil.getLengthInBits(data.mode,typeNumber));data.write(buffer);}\n\tvar totalDataCount=0;for(var i=0;i<rsBlocks.length;i++){totalDataCount+=rsBlocks[i].dataCount;}\n\tif(buffer.getLengthInBits()>totalDataCount*8){throw new Error(\"code length overflow. (\"\n\t+buffer.getLengthInBits()\n\t+\">\"\n\t+totalDataCount*8\n\t+\")\");}\n\tif(buffer.getLengthInBits()+4<=totalDataCount*8){buffer.put(0,4);}\n\twhile(buffer.getLengthInBits()%8!=0){buffer.putBit(false);}\n\twhile(true){if(buffer.getLengthInBits()>=totalDataCount*8){break;}\n\tbuffer.put(QRCodeModel.PAD0,8);if(buffer.getLengthInBits()>=totalDataCount*8){break;}\n\tbuffer.put(QRCodeModel.PAD1,8);}\n\treturn QRCodeModel.createBytes(buffer,rsBlocks);};QRCodeModel.createBytes=function(buffer,rsBlocks){var offset=0;var maxDcCount=0;var maxEcCount=0;var dcdata=new Array(rsBlocks.length);var ecdata=new Array(rsBlocks.length);for(var r=0;r<rsBlocks.length;r++){var dcCount=rsBlocks[r].dataCount;var ecCount=rsBlocks[r].totalCount-dcCount;maxDcCount=Math.max(maxDcCount,dcCount);maxEcCount=Math.max(maxEcCount,ecCount);dcdata[r]=new Array(dcCount);for(var i=0;i<dcdata[r].length;i++){dcdata[r][i]=0xff&buffer.buffer[i+offset];}\n\toffset+=dcCount;var rsPoly=QRUtil.getErrorCorrectPolynomial(ecCount);var rawPoly=new QRPolynomial(dcdata[r],rsPoly.getLength()-1);var modPoly=rawPoly.mod(rsPoly);ecdata[r]=new Array(rsPoly.getLength()-1);for(var i=0;i<ecdata[r].length;i++){var modIndex=i+modPoly.getLength()-ecdata[r].length;ecdata[r][i]=(modIndex>=0)?modPoly.get(modIndex):0;}}\n\tvar totalCodeCount=0;for(var i=0;i<rsBlocks.length;i++){totalCodeCount+=rsBlocks[i].totalCount;}\n\tvar data=new Array(totalCodeCount);var index=0;for(var i=0;i<maxDcCount;i++){for(var r=0;r<rsBlocks.length;r++){if(i<dcdata[r].length){data[index++]=dcdata[r][i];}}}\n\tfor(var i=0;i<maxEcCount;i++){for(var r=0;r<rsBlocks.length;r++){if(i<ecdata[r].length){data[index++]=ecdata[r][i];}}}\n\treturn data;};var QRMode={MODE_NUMBER:1<<0,MODE_ALPHA_NUM:1<<1,MODE_8BIT_BYTE:1<<2,MODE_KANJI:1<<3};var QRErrorCorrectLevel={L:1,M:0,Q:3,H:2};var QRMaskPattern={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};var QRUtil={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:(1<<10)|(1<<8)|(1<<5)|(1<<4)|(1<<2)|(1<<1)|(1<<0),G18:(1<<12)|(1<<11)|(1<<10)|(1<<9)|(1<<8)|(1<<5)|(1<<2)|(1<<0),G15_MASK:(1<<14)|(1<<12)|(1<<10)|(1<<4)|(1<<1),getBCHTypeInfo:function(data){var d=data<<10;while(QRUtil.getBCHDigit(d)-QRUtil.getBCHDigit(QRUtil.G15)>=0){d^=(QRUtil.G15<<(QRUtil.getBCHDigit(d)-QRUtil.getBCHDigit(QRUtil.G15)));}\n\treturn((data<<10)|d)^QRUtil.G15_MASK;},getBCHTypeNumber:function(data){var d=data<<12;while(QRUtil.getBCHDigit(d)-QRUtil.getBCHDigit(QRUtil.G18)>=0){d^=(QRUtil.G18<<(QRUtil.getBCHDigit(d)-QRUtil.getBCHDigit(QRUtil.G18)));}\n\treturn(data<<12)|d;},getBCHDigit:function(data){var digit=0;while(data!=0){digit++;data>>>=1;}\n\treturn digit;},getPatternPosition:function(typeNumber){return QRUtil.PATTERN_POSITION_TABLE[typeNumber-1];},getMask:function(maskPattern,i,j){switch(maskPattern){case QRMaskPattern.PATTERN000:return(i+j)%2==0;case QRMaskPattern.PATTERN001:return i%2==0;case QRMaskPattern.PATTERN010:return j%3==0;case QRMaskPattern.PATTERN011:return(i+j)%3==0;case QRMaskPattern.PATTERN100:return(Math.floor(i/2)+Math.floor(j/3))%2==0;case QRMaskPattern.PATTERN101:return(i*j)%2+(i*j)%3==0;case QRMaskPattern.PATTERN110:return((i*j)%2+(i*j)%3)%2==0;case QRMaskPattern.PATTERN111:return((i*j)%3+(i+j)%2)%2==0;default:throw new Error(\"bad maskPattern:\"+maskPattern);}},getErrorCorrectPolynomial:function(errorCorrectLength){var a=new QRPolynomial([1],0);for(var i=0;i<errorCorrectLength;i++){a=a.multiply(new QRPolynomial([1,QRMath.gexp(i)],0));}\n\treturn a;},getLengthInBits:function(mode,type){if(1<=type&&type<10){switch(mode){case QRMode.MODE_NUMBER:return 10;case QRMode.MODE_ALPHA_NUM:return 9;case QRMode.MODE_8BIT_BYTE:return 8;case QRMode.MODE_KANJI:return 8;default:throw new Error(\"mode:\"+mode);}}else if(type<27){switch(mode){case QRMode.MODE_NUMBER:return 12;case QRMode.MODE_ALPHA_NUM:return 11;case QRMode.MODE_8BIT_BYTE:return 16;case QRMode.MODE_KANJI:return 10;default:throw new Error(\"mode:\"+mode);}}else if(type<41){switch(mode){case QRMode.MODE_NUMBER:return 14;case QRMode.MODE_ALPHA_NUM:return 13;case QRMode.MODE_8BIT_BYTE:return 16;case QRMode.MODE_KANJI:return 12;default:throw new Error(\"mode:\"+mode);}}else{throw new Error(\"type:\"+type);}},getLostPoint:function(qrCode){var moduleCount=qrCode.getModuleCount();var lostPoint=0;for(var row=0;row<moduleCount;row++){for(var col=0;col<moduleCount;col++){var sameCount=0;var dark=qrCode.isDark(row,col);for(var r=-1;r<=1;r++){if(row+r<0||moduleCount<=row+r){continue;}\n\tfor(var c=-1;c<=1;c++){if(col+c<0||moduleCount<=col+c){continue;}\n\tif(r==0&&c==0){continue;}\n\tif(dark==qrCode.isDark(row+r,col+c)){sameCount++;}}}\n\tif(sameCount>5){lostPoint+=(3+sameCount-5);}}}\n\tfor(var row=0;row<moduleCount-1;row++){for(var col=0;col<moduleCount-1;col++){var count=0;if(qrCode.isDark(row,col))count++;if(qrCode.isDark(row+1,col))count++;if(qrCode.isDark(row,col+1))count++;if(qrCode.isDark(row+1,col+1))count++;if(count==0||count==4){lostPoint+=3;}}}\n\tfor(var row=0;row<moduleCount;row++){for(var col=0;col<moduleCount-6;col++){if(qrCode.isDark(row,col)&&!qrCode.isDark(row,col+1)&&qrCode.isDark(row,col+2)&&qrCode.isDark(row,col+3)&&qrCode.isDark(row,col+4)&&!qrCode.isDark(row,col+5)&&qrCode.isDark(row,col+6)){lostPoint+=40;}}}\n\tfor(var col=0;col<moduleCount;col++){for(var row=0;row<moduleCount-6;row++){if(qrCode.isDark(row,col)&&!qrCode.isDark(row+1,col)&&qrCode.isDark(row+2,col)&&qrCode.isDark(row+3,col)&&qrCode.isDark(row+4,col)&&!qrCode.isDark(row+5,col)&&qrCode.isDark(row+6,col)){lostPoint+=40;}}}\n\tvar darkCount=0;for(var col=0;col<moduleCount;col++){for(var row=0;row<moduleCount;row++){if(qrCode.isDark(row,col)){darkCount++;}}}\n\tvar ratio=Math.abs(100*darkCount/moduleCount/moduleCount-50)/5;lostPoint+=ratio*10;return lostPoint;}};var QRMath={glog:function(n){if(n<1){throw new Error(\"glog(\"+n+\")\");}\n\treturn QRMath.LOG_TABLE[n];},gexp:function(n){while(n<0){n+=255;}\n\twhile(n>=256){n-=255;}\n\treturn QRMath.EXP_TABLE[n];},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)};for(var i=0;i<8;i++){QRMath.EXP_TABLE[i]=1<<i;}\n\tfor(var i=8;i<256;i++){QRMath.EXP_TABLE[i]=QRMath.EXP_TABLE[i-4]^QRMath.EXP_TABLE[i-5]^QRMath.EXP_TABLE[i-6]^QRMath.EXP_TABLE[i-8];}\n\tfor(var i=0;i<255;i++){QRMath.LOG_TABLE[QRMath.EXP_TABLE[i]]=i;}\n\tfunction QRPolynomial(num,shift){if(num.length==undefined){throw new Error(num.length+\"/\"+shift);}\n\tvar offset=0;while(offset<num.length&&num[offset]==0){offset++;}\n\tthis.num=new Array(num.length-offset+shift);for(var i=0;i<num.length-offset;i++){this.num[i]=num[i+offset];}}\n\tQRPolynomial.prototype={get:function(index){return this.num[index];},getLength:function(){return this.num.length;},multiply:function(e){var num=new Array(this.getLength()+e.getLength()-1);for(var i=0;i<this.getLength();i++){for(var j=0;j<e.getLength();j++){num[i+j]^=QRMath.gexp(QRMath.glog(this.get(i))+QRMath.glog(e.get(j)));}}\n\treturn new QRPolynomial(num,0);},mod:function(e){if(this.getLength()-e.getLength()<0){return this;}\n\tvar ratio=QRMath.glog(this.get(0))-QRMath.glog(e.get(0));var num=new Array(this.getLength());for(var i=0;i<this.getLength();i++){num[i]=this.get(i);}\n\tfor(var i=0;i<e.getLength();i++){num[i]^=QRMath.gexp(QRMath.glog(e.get(i))+ratio);}\n\treturn new QRPolynomial(num,0).mod(e);}};function QRRSBlock(totalCount,dataCount){this.totalCount=totalCount;this.dataCount=dataCount;}\n\tQRRSBlock.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];QRRSBlock.getRSBlocks=function(typeNumber,errorCorrectLevel){var rsBlock=QRRSBlock.getRsBlockTable(typeNumber,errorCorrectLevel);if(rsBlock==undefined){throw new Error(\"bad rs block @ typeNumber:\"+typeNumber+\"/errorCorrectLevel:\"+errorCorrectLevel);}\n\tvar length=rsBlock.length/3;var list=[];for(var i=0;i<length;i++){var count=rsBlock[i*3+0];var totalCount=rsBlock[i*3+1];var dataCount=rsBlock[i*3+2];for(var j=0;j<count;j++){list.push(new QRRSBlock(totalCount,dataCount));}}\n\treturn list;};QRRSBlock.getRsBlockTable=function(typeNumber,errorCorrectLevel){switch(errorCorrectLevel){case QRErrorCorrectLevel.L:return QRRSBlock.RS_BLOCK_TABLE[(typeNumber-1)*4+0];case QRErrorCorrectLevel.M:return QRRSBlock.RS_BLOCK_TABLE[(typeNumber-1)*4+1];case QRErrorCorrectLevel.Q:return QRRSBlock.RS_BLOCK_TABLE[(typeNumber-1)*4+2];case QRErrorCorrectLevel.H:return QRRSBlock.RS_BLOCK_TABLE[(typeNumber-1)*4+3];default:return undefined;}};function QRBitBuffer(){this.buffer=[];this.length=0;}\n\tQRBitBuffer.prototype={get:function(index){var bufIndex=Math.floor(index/8);return((this.buffer[bufIndex]>>>(7-index%8))&1)==1;},put:function(num,length){for(var i=0;i<length;i++){this.putBit(((num>>>(length-i-1))&1)==1);}},getLengthInBits:function(){return this.length;},putBit:function(bit){var bufIndex=Math.floor(this.length/8);if(this.buffer.length<=bufIndex){this.buffer.push(0);}\n\tif(bit){this.buffer[bufIndex]|=(0x80>>>(this.length%8));}\n\tthis.length++;}};var QRCodeLimitLength=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]];\n\t\n\tfunction _isSupportCanvas() {\n\t\treturn typeof CanvasRenderingContext2D != \"undefined\";\n\t}\n\t\n\t// android 2.x doesn't support Data-URI spec\n\tfunction _getAndroid() {\n\t\tvar android = false;\n\t\tvar sAgent = navigator.userAgent;\n\t\t\n\t\tif (/android/i.test(sAgent)) { // android\n\t\t\tandroid = true;\n\t\t\tvar aMat = sAgent.toString().match(/android ([0-9]\\.[0-9])/i);\n\t\t\t\n\t\t\tif (aMat && aMat[1]) {\n\t\t\t\tandroid = parseFloat(aMat[1]);\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn android;\n\t}\n\t\n\tvar svgDrawer = (function() {\n\n\t\tvar Drawing = function (el, htOption) {\n\t\t\tthis._el = el;\n\t\t\tthis._htOption = htOption;\n\t\t};\n\n\t\tDrawing.prototype.draw = function (oQRCode) {\n\t\t\tvar _htOption = this._htOption;\n\t\t\tvar _el = this._el;\n\t\t\tvar nCount = oQRCode.getModuleCount();\n\t\t\tvar nWidth = Math.floor(_htOption.width / nCount);\n\t\t\tvar nHeight = Math.floor(_htOption.height / nCount);\n\n\t\t\tthis.clear();\n\n\t\t\tfunction makeSVG(tag, attrs) {\n\t\t\t\tvar el = document.createElementNS('http://www.w3.org/2000/svg', tag);\n\t\t\t\tfor (var k in attrs)\n\t\t\t\t\tif (attrs.hasOwnProperty(k)) el.setAttribute(k, attrs[k]);\n\t\t\t\treturn el;\n\t\t\t}\n\n\t\t\tvar svg = makeSVG(\"svg\" , {'viewBox': '0 0 ' + String(nCount) + \" \" + String(nCount), 'width': '100%', 'height': '100%', 'fill': _htOption.colorLight});\n\t\t\tsvg.setAttributeNS(\"http://www.w3.org/2000/xmlns/\", \"xmlns:xlink\", \"http://www.w3.org/1999/xlink\");\n\t\t\t_el.appendChild(svg);\n\n\t\t\tsvg.appendChild(makeSVG(\"rect\", {\"fill\": _htOption.colorLight, \"width\": \"100%\", \"height\": \"100%\"}));\n\t\t\tsvg.appendChild(makeSVG(\"rect\", {\"fill\": _htOption.colorDark, \"width\": \"1\", \"height\": \"1\", \"id\": \"template\"}));\n\n\t\t\tfor (var row = 0; row < nCount; row++) {\n\t\t\t\tfor (var col = 0; col < nCount; col++) {\n\t\t\t\t\tif (oQRCode.isDark(row, col)) {\n\t\t\t\t\t\tvar child = makeSVG(\"use\", {\"x\": String(row), \"y\": String(col)});\n\t\t\t\t\t\tchild.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"href\", \"#template\")\n\t\t\t\t\t\tsvg.appendChild(child);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tDrawing.prototype.clear = function () {\n\t\t\twhile (this._el.hasChildNodes())\n\t\t\t\tthis._el.removeChild(this._el.lastChild);\n\t\t};\n\t\treturn Drawing;\n\t})();\n\n\tvar useSVG = document.documentElement.tagName.toLowerCase() === \"svg\";\n\n\t// Drawing in DOM by using Table tag\n\tvar Drawing = useSVG ? svgDrawer : !_isSupportCanvas() ? (function () {\n\t\tvar Drawing = function (el, htOption) {\n\t\t\tthis._el = el;\n\t\t\tthis._htOption = htOption;\n\t\t};\n\t\t\t\n\t\t/**\n\t\t * Draw the QRCode\n\t\t * \n\t\t * @param {QRCode} oQRCode\n\t\t */\n\t\tDrawing.prototype.draw = function (oQRCode) {\n            var _htOption = this._htOption;\n            var _el = this._el;\n\t\t\tvar nCount = oQRCode.getModuleCount();\n\t\t\tvar nWidth = Math.floor(_htOption.width / nCount);\n\t\t\tvar nHeight = Math.floor(_htOption.height / nCount);\n\t\t\tvar aHTML = ['<table style=\"border:0;border-collapse:collapse;\">'];\n\t\t\t\n\t\t\tfor (var row = 0; row < nCount; row++) {\n\t\t\t\taHTML.push('<tr>');\n\t\t\t\t\n\t\t\t\tfor (var col = 0; col < nCount; col++) {\n\t\t\t\t\taHTML.push('<td style=\"border:0;border-collapse:collapse;padding:0;margin:0;width:' + nWidth + 'px;height:' + nHeight + 'px;background-color:' + (oQRCode.isDark(row, col) ? _htOption.colorDark : _htOption.colorLight) + ';\"></td>');\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\taHTML.push('</tr>');\n\t\t\t}\n\t\t\t\n\t\t\taHTML.push('</table>');\n\t\t\t_el.innerHTML = aHTML.join('');\n\t\t\t\n\t\t\t// Fix the margin values as real size.\n\t\t\tvar elTable = _el.childNodes[0];\n\t\t\tvar nLeftMarginTable = (_htOption.width - elTable.offsetWidth) / 2;\n\t\t\tvar nTopMarginTable = (_htOption.height - elTable.offsetHeight) / 2;\n\t\t\t\n\t\t\tif (nLeftMarginTable > 0 && nTopMarginTable > 0) {\n\t\t\t\telTable.style.margin = nTopMarginTable + \"px \" + nLeftMarginTable + \"px\";\t\n\t\t\t}\n\t\t};\n\t\t\n\t\t/**\n\t\t * Clear the QRCode\n\t\t */\n\t\tDrawing.prototype.clear = function () {\n\t\t\tthis._el.innerHTML = '';\n\t\t};\n\t\t\n\t\treturn Drawing;\n\t})() : (function () { // Drawing in Canvas\n\t\tfunction _onMakeImage() {\n\t\t\tthis._elImage.src = this._elCanvas.toDataURL(\"image/png\");\n\t\t\tthis._elImage.style.display = \"block\";\n\t\t\tthis._elCanvas.style.display = \"none\";\t\t\t\n\t\t}\n\t\t\n\t\t// Android 2.1 bug workaround\n\t\t// http://code.google.com/p/android/issues/detail?id=5141\n\t\tif (this._android && this._android <= 2.1) {\n\t    \tvar factor = 1 / window.devicePixelRatio;\n\t        var drawImage = CanvasRenderingContext2D.prototype.drawImage; \n\t    \tCanvasRenderingContext2D.prototype.drawImage = function (image, sx, sy, sw, sh, dx, dy, dw, dh) {\n\t    \t\tif ((\"nodeName\" in image) && /img/i.test(image.nodeName)) {\n\t\t        \tfor (var i = arguments.length - 1; i >= 1; i--) {\n\t\t            \targuments[i] = arguments[i] * factor;\n\t\t        \t}\n\t    \t\t} else if (typeof dw == \"undefined\") {\n\t    \t\t\targuments[1] *= factor;\n\t    \t\t\targuments[2] *= factor;\n\t    \t\t\targuments[3] *= factor;\n\t    \t\t\targuments[4] *= factor;\n\t    \t\t}\n\t    \t\t\n\t        \tdrawImage.apply(this, arguments); \n\t    \t};\n\t\t}\n\t\t\n\t\t/**\n\t\t * Check whether the user's browser supports Data URI or not\n\t\t * \n\t\t * @private\n\t\t * @param {Function} fSuccess Occurs if it supports Data URI\n\t\t * @param {Function} fFail Occurs if it doesn't support Data URI\n\t\t */\n\t\tfunction _safeSetDataURI(fSuccess, fFail) {\n            var self = this;\n            self._fFail = fFail;\n            self._fSuccess = fSuccess;\n\n            // Check it just once\n            if (self._bSupportDataURI === null) {\n                var el = document.createElement(\"img\");\n                var fOnError = function() {\n                    self._bSupportDataURI = false;\n\n                    if (self._fFail) {\n                        self._fFail.call(self);\n                    }\n                };\n                var fOnSuccess = function() {\n                    self._bSupportDataURI = true;\n\n                    if (self._fSuccess) {\n                        self._fSuccess.call(self);\n                    }\n                };\n\n                el.onabort = fOnError;\n                el.onerror = fOnError;\n                el.onload = fOnSuccess;\n                el.src = \"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==\"; // the Image contains 1px data.\n                return;\n            } else if (self._bSupportDataURI === true && self._fSuccess) {\n                self._fSuccess.call(self);\n            } else if (self._bSupportDataURI === false && self._fFail) {\n                self._fFail.call(self);\n            }\n\t\t};\n\t\t\n\t\t/**\n\t\t * Drawing QRCode by using canvas\n\t\t * \n\t\t * @constructor\n\t\t * @param {HTMLElement} el\n\t\t * @param {Object} htOption QRCode Options \n\t\t */\n\t\tvar Drawing = function (el, htOption) {\n    \t\tthis._bIsPainted = false;\n    \t\tthis._android = _getAndroid();\n\t\t\n\t\t\tthis._htOption = htOption;\n\t\t\tthis._elCanvas = document.createElement(\"canvas\");\n\t\t\tthis._elCanvas.width = htOption.width;\n\t\t\tthis._elCanvas.height = htOption.height;\n\t\t\tel.appendChild(this._elCanvas);\n\t\t\tthis._el = el;\n\t\t\tthis._oContext = this._elCanvas.getContext(\"2d\");\n\t\t\tthis._bIsPainted = false;\n\t\t\tthis._elImage = document.createElement(\"img\");\n\t\t\tthis._elImage.alt = \"Scan me!\";\n\t\t\tthis._elImage.style.display = \"none\";\n\t\t\tthis._el.appendChild(this._elImage);\n\t\t\tthis._bSupportDataURI = null;\n\t\t};\n\t\t\t\n\t\t/**\n\t\t * Draw the QRCode\n\t\t * \n\t\t * @param {QRCode} oQRCode \n\t\t */\n\t\tDrawing.prototype.draw = function (oQRCode) {\n            var _elImage = this._elImage;\n            var _oContext = this._oContext;\n            var _htOption = this._htOption;\n            \n\t\t\tvar nCount = oQRCode.getModuleCount();\n\t\t\tvar nWidth = _htOption.width / nCount;\n\t\t\tvar nHeight = _htOption.height / nCount;\n\t\t\tvar nRoundedWidth = Math.round(nWidth);\n\t\t\tvar nRoundedHeight = Math.round(nHeight);\n\n\t\t\t_elImage.style.display = \"none\";\n\t\t\tthis.clear();\n\t\t\t\n\t\t\tfor (var row = 0; row < nCount; row++) {\n\t\t\t\tfor (var col = 0; col < nCount; col++) {\n\t\t\t\t\tvar bIsDark = oQRCode.isDark(row, col);\n\t\t\t\t\tvar nLeft = col * nWidth;\n\t\t\t\t\tvar nTop = row * nHeight;\n\t\t\t\t\t_oContext.strokeStyle = bIsDark ? _htOption.colorDark : _htOption.colorLight;\n\t\t\t\t\t_oContext.lineWidth = 1;\n\t\t\t\t\t_oContext.fillStyle = bIsDark ? _htOption.colorDark : _htOption.colorLight;\t\t\t\t\t\n\t\t\t\t\t_oContext.fillRect(nLeft, nTop, nWidth, nHeight);\n\t\t\t\t\t\n\t\t\t\t\t// 안티 앨리어싱 방지 처리\n\t\t\t\t\t_oContext.strokeRect(\n\t\t\t\t\t\tMath.floor(nLeft) + 0.5,\n\t\t\t\t\t\tMath.floor(nTop) + 0.5,\n\t\t\t\t\t\tnRoundedWidth,\n\t\t\t\t\t\tnRoundedHeight\n\t\t\t\t\t);\n\t\t\t\t\t\n\t\t\t\t\t_oContext.strokeRect(\n\t\t\t\t\t\tMath.ceil(nLeft) - 0.5,\n\t\t\t\t\t\tMath.ceil(nTop) - 0.5,\n\t\t\t\t\t\tnRoundedWidth,\n\t\t\t\t\t\tnRoundedHeight\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tthis._bIsPainted = true;\n\t\t};\n\t\t\t\n\t\t/**\n\t\t * Make the image from Canvas if the browser supports Data URI.\n\t\t */\n\t\tDrawing.prototype.makeImage = function () {\n\t\t\tif (this._bIsPainted) {\n\t\t\t\t_safeSetDataURI.call(this, _onMakeImage);\n\t\t\t}\n\t\t};\n\t\t\t\n\t\t/**\n\t\t * Return whether the QRCode is painted or not\n\t\t * \n\t\t * @return {Boolean}\n\t\t */\n\t\tDrawing.prototype.isPainted = function () {\n\t\t\treturn this._bIsPainted;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Clear the QRCode\n\t\t */\n\t\tDrawing.prototype.clear = function () {\n\t\t\tthis._oContext.clearRect(0, 0, this._elCanvas.width, this._elCanvas.height);\n\t\t\tthis._bIsPainted = false;\n\t\t};\n\t\t\n\t\t/**\n\t\t * @private\n\t\t * @param {Number} nNumber\n\t\t */\n\t\tDrawing.prototype.round = function (nNumber) {\n\t\t\tif (!nNumber) {\n\t\t\t\treturn nNumber;\n\t\t\t}\n\t\t\t\n\t\t\treturn Math.floor(nNumber * 1000) / 1000;\n\t\t};\n\t\t\n\t\treturn Drawing;\n\t})();\n\t\n\t/**\n\t * Get the type by string length\n\t * \n\t * @private\n\t * @param {String} sText\n\t * @param {Number} nCorrectLevel\n\t * @return {Number} type\n\t */\n\tfunction _getTypeNumber(sText, nCorrectLevel) {\t\t\t\n\t\tvar nType = 1;\n\t\tvar length = _getUTF8Length(sText);\n\t\t\n\t\tfor (var i = 0, len = QRCodeLimitLength.length; i <= len; i++) {\n\t\t\tvar nLimit = 0;\n\t\t\t\n\t\t\tswitch (nCorrectLevel) {\n\t\t\t\tcase QRErrorCorrectLevel.L :\n\t\t\t\t\tnLimit = QRCodeLimitLength[i][0];\n\t\t\t\t\tbreak;\n\t\t\t\tcase QRErrorCorrectLevel.M :\n\t\t\t\t\tnLimit = QRCodeLimitLength[i][1];\n\t\t\t\t\tbreak;\n\t\t\t\tcase QRErrorCorrectLevel.Q :\n\t\t\t\t\tnLimit = QRCodeLimitLength[i][2];\n\t\t\t\t\tbreak;\n\t\t\t\tcase QRErrorCorrectLevel.H :\n\t\t\t\t\tnLimit = QRCodeLimitLength[i][3];\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t\n\t\t\tif (length <= nLimit) {\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tnType++;\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (nType > QRCodeLimitLength.length) {\n\t\t\tthrow new Error(\"Too long data\");\n\t\t}\n\t\t\n\t\treturn nType;\n\t}\n\n\tfunction _getUTF8Length(sText) {\n\t\tvar replacedText = encodeURI(sText).toString().replace(/\\%[0-9a-fA-F]{2}/g, 'a');\n\t\treturn replacedText.length + (replacedText.length != sText ? 3 : 0);\n\t}\n\t\n\t/**\n\t * @class QRCode\n\t * @constructor\n\t * @example \n\t * new QRCode(document.getElementById(\"test\"), \"http://jindo.dev.naver.com/collie\");\n\t *\n\t * @example\n\t * var oQRCode = new QRCode(\"test\", {\n\t *    text : \"http://naver.com\",\n\t *    width : 128,\n\t *    height : 128\n\t * });\n\t * \n\t * oQRCode.clear(); // Clear the QRCode.\n\t * oQRCode.makeCode(\"http://map.naver.com\"); // Re-create the QRCode.\n\t *\n\t * @param {HTMLElement|String} el target element or 'id' attribute of element.\n\t * @param {Object|String} vOption\n\t * @param {String} vOption.text QRCode link data\n\t * @param {Number} [vOption.width=256]\n\t * @param {Number} [vOption.height=256]\n\t * @param {String} [vOption.colorDark=\"#000000\"]\n\t * @param {String} [vOption.colorLight=\"#ffffff\"]\n\t * @param {QRCode.CorrectLevel} [vOption.correctLevel=QRCode.CorrectLevel.H] [L|M|Q|H] \n\t */\n\tQRCode = function (el, vOption) {\n\t\tthis._htOption = {\n\t\t\twidth : 256, \n\t\t\theight : 256,\n\t\t\ttypeNumber : 4,\n\t\t\tcolorDark : \"#000000\",\n\t\t\tcolorLight : \"#ffffff\",\n\t\t\tcorrectLevel : QRErrorCorrectLevel.H\n\t\t};\n\t\t\n\t\tif (typeof vOption === 'string') {\n\t\t\tvOption\t= {\n\t\t\t\ttext : vOption\n\t\t\t};\n\t\t}\n\t\t\n\t\t// Overwrites options\n\t\tif (vOption) {\n\t\t\tfor (var i in vOption) {\n\t\t\t\tthis._htOption[i] = vOption[i];\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (typeof el == \"string\") {\n\t\t\tel = document.getElementById(el);\n\t\t}\n\n\t\tif (this._htOption.useSVG) {\n\t\t\tDrawing = svgDrawer;\n\t\t}\n\t\t\n\t\tthis._android = _getAndroid();\n\t\tthis._el = el;\n\t\tthis._oQRCode = null;\n\t\tthis._oDrawing = new Drawing(this._el, this._htOption);\n\t\t\n\t\tif (this._htOption.text) {\n\t\t\tthis.makeCode(this._htOption.text);\t\n\t\t}\n\t};\n\t\n\t/**\n\t * Make the QRCode\n\t * \n\t * @param {String} sText link data\n\t */\n\tQRCode.prototype.makeCode = function (sText) {\n\t\tthis._oQRCode = new QRCodeModel(_getTypeNumber(sText, this._htOption.correctLevel), this._htOption.correctLevel);\n\t\tthis._oQRCode.addData(sText);\n\t\tthis._oQRCode.make();\n\t\tthis._el.title = sText;\n\t\tthis._oDrawing.draw(this._oQRCode);\t\t\t\n\t\tthis.makeImage();\n\t};\n\t\n\t/**\n\t * Make the Image from Canvas element\n\t * - It occurs automatically\n\t * - Android below 3 doesn't support Data-URI spec.\n\t * \n\t * @private\n\t */\n\tQRCode.prototype.makeImage = function () {\n\t\tif (typeof this._oDrawing.makeImage == \"function\" && (!this._android || this._android >= 3)) {\n\t\t\tthis._oDrawing.makeImage();\n\t\t}\n\t};\n\t\n\t/**\n\t * Clear the QRCode\n\t */\n\tQRCode.prototype.clear = function () {\n\t\tthis._oDrawing.clear();\n\t};\n\t\n\t/**\n\t * @name QRCode.CorrectLevel\n\t */\n\tQRCode.CorrectLevel = QRErrorCorrectLevel;\n\t\n\treturn QRCode;\n});\n\n","\ndefine('tpl!taoQtiPrint/runner/tpl/pageTest', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, functionType=\"function\", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing, self=this;\n\nfunction program1(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"\\n<h3>\";\n  if (helper = helpers.uniqid) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.uniqid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</h3>\\n\";\n  return buffer;\n  }\n\nfunction program3(depth0,data) {\n  \n  var buffer = \"\", stack1, helper, options;\n  buffer += \"\\n    <div class=\\\"logo\\\">\\n        <img src=\\\"\";\n  if (helper = helpers.logo) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.logo); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" alt=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Logo\", options) : helperMissing.call(depth0, \"__\", \"Logo\", options)))\n    + \"\\\" />\\n    </div>\\n\";\n  return buffer;\n  }\n\nfunction program5(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"\\n    <h2>\";\n  if (helper = helpers.subtitle) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.subtitle); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</h2>\\n\";\n  return buffer;\n  }\n\nfunction program7(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"\\n    <h3>\";\n  if (helper = helpers.date) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.date); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</h3>\\n\";\n  return buffer;\n  }\n\nfunction program9(depth0,data) {\n  \n  \n  return \"\\n    <div class=\\\"qr-code\\\"></div>\\n\";\n  }\n\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.uniqid), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n\";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.logo), {hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n    <h1>\";\n  if (helper = helpers.title) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.title); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</h1>\\n\";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.subtitle), {hash:{},inverse:self.noop,fn:self.program(5, program5, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n\";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.date), {hash:{},inverse:self.noop,fn:self.program(7, program7, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n\";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.qrcode), {hash:{},inverse:self.noop,fn:self.program(9, program9, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n\";\n  return buffer;\n  });\n});\n\n","\ndefine('tpl!taoQtiPrint/runner/tpl/pageSection', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, functionType=\"function\", escapeExpression=this.escapeExpression, self=this;\n\nfunction program1(depth0,data) {\n  \n  var buffer = \"\", stack1;\n  buffer += \"\\n<div>\";\n  stack1 = (typeof depth0 === functionType ? depth0.apply(depth0) : depth0);\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"</div>\\n\";\n  return buffer;\n  }\n\n  buffer += \"<h2>\";\n  if (helper = helpers.title) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.title); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</h2>\\n\";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.rubricBlock), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n\";\n  return buffer;\n  });\n});\n\n","\ndefine('tpl!taoQtiPrint/runner/tpl/pageBlock', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, functionType=\"function\", escapeExpression=this.escapeExpression;\n\n\n  buffer += \"<section class=\\\"\";\n  if (helper = helpers.type) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.type); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\"></section>\";\n  return buffer;\n  });\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA;\n */\n\n/**\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n * @author Jean-Sébastien Conan <jean-sebastien@taotesting.com>\n */\ndefine('taoQtiPrint/runner/testRenderers',[\n    'jquery',\n    'lodash',\n    'util/url',\n    'taoQtiPrint/runner/itemRunner',\n    'taoItems/assets/strategies',\n    'taoQtiPrint/lib/qrcode',\n    'tpl!taoQtiPrint/runner/tpl/pageTest',\n    'tpl!taoQtiPrint/runner/tpl/pageSection',\n    'tpl!taoQtiPrint/runner/tpl/pageBlock'\n], function ($,\n             _,\n             urlHelper,\n             itemRunner,\n             assetStrategies,\n             QRCode,\n             pageTestTpl,\n             pageSectionTpl) {\n    'use strict';\n\n    /**\n     * Defines renderers for each blocks in the printed test\n     * @typedef {testRenderers}\n     */\n    return {\n\n        /**\n         * Renders a block that represents a cover page\n         * @param {jQuery} $container - The container in which renders the block\n         * @param {Object} test - The test definition\n         * @param {Object} options - The print options\n         * @param {Function} done - A callback to call when the block is fully rendered\n         */\n        testPage: function testPage($container, test, options, done) {\n            var coverPageOptions = options && options.cover_page || {};\n\n            $(pageTestTpl({\n                title: coverPageOptions['title'] && test.title,\n                subtitle: coverPageOptions['description'] && options.description,\n                qrcode: coverPageOptions['qr_code'],\n                logo: coverPageOptions['logo'] && options.logo,\n                date: coverPageOptions['date'] && options.date,\n                uniqid: coverPageOptions['unique_id'] && options.unique_id\n            })).appendTo($container);\n\n            if (coverPageOptions['qr_code']) {\n                new QRCode($('.qr-code', $container).get(0), {\n                    text: coverPageOptions['qr_code_data'] || urlHelper.route('render', 'PrintTest', 'taoBooklet', {uri: options.uri}),\n                    width: 192,\n                    height: 192,\n                    colorDark: \"#000000\",\n                    colorLight: \"#ffffff\",\n                    correctLevel: QRCode.CorrectLevel.H\n                });\n            }\n\n            done();\n        },\n\n        /**\n         * Renders a block that represents a section of the test\n         * @param {jQuery} $container - The container in which renders the block\n         * @param {Object} section - The section definition\n         * @param {Function} done - A callback to call when the block is fully rendered\n         */\n        sectionPage: function sectionPage($container, section, done) {\n\n            $(pageSectionTpl({\n                title: section.title,\n                rubricBlock: section.rubricBlock\n            })).appendTo($container);\n\n            done();\n        },\n\n        /**\n         * Renders a block that represents an item of the test\n         * @param {jQuery} $container - The container in which renders the block\n         * @param {Object} itemRef - The item definition\n         * @param {Object} itemState - The responses of the item\n         * @param {String} uri - The URI of the item\n         * @param {Function} done - A callback to call when the block is fully rendered\n         */\n        itemPage: function itemPage($container, itemRef, itemState, uri, done) {\n            var item = itemRef.data;\n            var assets = itemRef.assets;\n            var baseUrl = itemRef.baseUrl || urlHelper.route('getFile', 'QtiCreator', 'taoQtiItem', {\n                uri: uri,\n                lang: 'en-US'\n            }) + '&relPath=';\n            var isDone = false;\n\n            /**\n             * @param [err]\n             */\n            function itemDone(err) {\n                if (!isDone) {\n                    isDone = true;\n                    done(err);\n                }\n            }\n\n            itemRunner('qtiprint', item, {\n                    renderer: itemRef.renderer,\n                    showResponseIdentifier: itemRef.showResponseIdentifier\n                })\n                .on('error', function (err) {\n                    itemDone(err);\n                })\n                .on('init', function () {\n                    if (itemState && _.isPlainObject(itemState)) {\n                        this.setState(itemState);\n                    }\n                    this.render($container);\n                })\n                .on('ready', function () {\n                    itemDone();\n                })\n                .assets([\n                    {\n                        name: 'base64package',\n                        handle: function handleBase64(url) {\n                            var id = url.file;\n                            var found = _.find(assets, function (assetsList) {\n                                var asset = assetsList[id];\n                                return !!(asset && urlHelper.isBase64(asset));\n                            });\n                            if (found) {\n                                return found[id];\n                            }\n                        }\n                    },\n                    assetStrategies.taomedia,\n                    assetStrategies.external,\n                    assetStrategies.baseUrl\n                ], {\n                    baseUrl: baseUrl\n                })\n                .init();\n        }\n    };\n});\n\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015-2017 (original work) Open Assessment Technologies SA;\n */\n\n/**\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\ndefine('taoQtiPrint/runner/testRunner',[\n    'jquery',\n    'lodash',\n    'async',\n    'core/eventifier',\n    'taoQtiPrint/runner/testRenderers',\n    'tpl!taoQtiPrint/runner/tpl/pageBlock'\n], function ($,\n             _,\n             asyncLib,\n             eventifier,\n             testRenderers,\n             pageBlockTpl) {\n    'use strict';\n\n    /**\n     *\n     * Builds a brand new {@link TestRunner}.\n     *\n     * <strong>The factory is an internal mechanism to create encapsulated contexts.\n     *  I suggest you to use directly the name <i>testRunner</i> when you require this module.</strong>\n     *\n     *\n     * @exports testRunner\n     * @namespace testRunnerFactory\n     *\n     *\n     * @returns {testRunner}\n     */\n    var testRunnerFactory = function testRunnerFactory(testDefinitions, options) {\n        var layoutOptions = options && options.layout || {};\n        var $container;\n\n        /**\n         * Creates a container for a test block\n         * @param {String} type\n         * @returns {jQuery}\n         */\n        function createPage(type) {\n            var $pageBlock = $(pageBlockTpl({type: type}));\n            $container.append($pageBlock);\n            return $pageBlock;\n        }\n\n        if (!testDefinitions) {\n            throw new Error('Invalid test data structure');\n        }\n\n        if (!_.isArray(testDefinitions)) {\n            testDefinitions = [testDefinitions];\n        }\n\n        _.forEach(testDefinitions, function(testDefinition) {\n            if (!testDefinition) {\n                throw new Error('Invalid test data structure: definition is empty');\n            }\n            if (!testDefinition.data) {\n                throw new Error('Invalid test data structure: data is missing');\n            }\n            if (!testDefinition.items) {\n                throw new Error('Invalid test data structure: items is missing');\n            }\n        });\n\n        /**\n         * @typedef {testRunner}\n         */\n        return eventifier({\n            /**\n             * Makes the rendering of the full test.\n             *\n             * @param {HTMLElement|jQueryElement} elt - the DOM element that is going to contain the rendered test.\n             * @returns {testRunner} to chain calls\n             *\n             * @fires testRunner#ready\n             * @fires testRunner#render\n             * @fires testRunner#error if the elt isn't valid\n             */\n            render: function render(elt) {\n                var self = this;\n                var pageRenderers = [];\n\n                //check elt\n                if (!(elt instanceof HTMLElement) && !(elt instanceof $)) {\n                    return self.trigger('error', 'A valid HTMLElement (or a jquery element) at least is required to render the test');\n                }\n\n                //we keep a reference to the container\n                if (elt instanceof $) {\n                    $container = elt;\n                } else {\n                    $container = $(elt);\n                }\n                $container.empty();\n\n                //dummy rtl support from options\n                if (options && options.rtl === true) {\n                    $container.addClass('rtl').attr('dir', 'rtl');\n                }\n\n                //Build the pageRenderers array that contains each page to render\n                //Transform the functions of the renderer to fit the format required by async (partial with data and binding)\n                _.forEach(testDefinitions, function(testDefinition) {\n                    var testData = testDefinition.data || {};\n                    var items = testDefinition.items || {};\n                    var states = testDefinition.states || {};\n\n                    if (layoutOptions['cover_page']) {\n                        pageRenderers.push(\n                            _.partial(testRenderers.testPage, createPage('title'), testData, options)\n                        );\n                    }\n\n                    _.forEach(testData.testParts, function (testPart) {\n                        _.forEach(testPart.sections, function (section) {\n                            pageRenderers.push(\n                                _.partial(testRenderers.sectionPage, createPage('section'), section)\n                            );\n\n                            _.forEach(section.items, function (item) {\n                                var itemRef = items[item.href];\n                                var itemState = states[item.href];\n\n                                if (itemRef && itemRef.data) {\n                                    itemRef.renderer = 'booklet';\n\n                                    if(options.regular) {\n                                        itemRef.renderer = 'results';\n                                    }\n                                    else if(options.layout && options.layout.use_bubble_sheet) {\n                                        itemRef.renderer = 'bubbleSheet';\n                                    }\n\n                                    if(options && options.layout && options.layout.show_response_identifier){\n                                        itemRef.showResponseIdentifier = true;\n                                    }\n                                    pageRenderers.push(\n                                        _.partial(testRenderers.itemPage, createPage('item'), itemRef, itemState, item.href)\n                                    );\n                                }\n                            });\n                        });\n                    });\n                });\n\n                //then we call all the renderers in parallel\n                asyncLib.parallel(pageRenderers, function renderingDone(err) {\n                    if (err) {\n                        self.trigger('error', 'An error occurred while rendering a page :  ' + err);\n                    }\n\n                    /**\n                     * The test is rendered\n                     * @event TestRunner#render\n                     */\n                    self.trigger('render');\n\n                    /**\n                     * The test is ready.\n                     * Alias of {@link TestRunner#render}\n                     * @event TestRunner#ready\n                     */\n                    self.trigger('ready');\n                });\n\n                return this;\n            },\n\n            /**\n             * Clears the running test.\n             * @returns {testRunner}\n             *\n             * @fires testRunner#clear\n             */\n            clear: function clear() {\n\n                $container.empty();\n\n                /**\n                 * The test is ready.\n                 * @event TestRunner#clear\n                 */\n                this.trigger('clear');\n\n                return this;\n            }\n        });\n    };\n\n    return testRunnerFactory;\n});\n\n","\ndefine('tpl!taoBooklet/tpl/print', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, functionType=\"function\", escapeExpression=this.escapeExpression;\n\n\n  buffer += \"<main class=\\\"tao-scope \";\n  if (helper = helpers.cls) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.cls); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\"></main>\\n\";\n  return buffer;\n  });\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015-2017 (original work) Open Assessment Technologies SA;\n */\n\n/**\n *\n * This controller renders a printable test in the current page.\n *\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\ndefine('taoBooklet/controller/PrintTest/render',[\n    'jquery',\n    'lodash',\n    'core/logger',\n    'taoQtiPrint/runner/testRunner',\n    'tpl!taoBooklet/tpl/print'\n], function ($, _, loggerFactory, testRunner, printTpl) {\n    'use strict';\n\n    var logger = loggerFactory('printTest/render');\n\n    /**\n     * Old school way to debug document, especially when generated in PDF.\n     * It appends the message to the body.\n     * @param {String} msg - the content to display\n     * @param {String} type - the type of message\n     */\n    function showMessage(msg, type) {\n        type = type || 'info';\n        $('body').append('<div class=\"feedback-' + type + '\">' + msg + '</div>');\n    }\n\n    /**\n     * Hack the current layout to match arbitrary rules\n     */\n    function printLayoutHacking($container) {\n\n        var threshold = 6000;   //this height seems to work - value is empirical and linked to the A4 page layout with 300 DPI\n        var pages = 2;          //start on page 2\n        var previous;           //keep a ref to the previous section\n\n        //add a blank page\n        var blankPage = function blankPage($section) {\n            $section.before('<div class=\"breaker\"></div>');\n            pages++;\n        };\n\n        //add pages based on the given height\n        var computePageFromHeight = function computePageFromHeight(height) {\n            if (height > threshold) {\n                pages += Math.ceil(height / threshold) - 1;\n            }\n        };\n\n        //browse direct section add apply the odd/even rules for section and items\n        $container.children('section').each(function () {\n            var $section = $(this);\n            var height;\n\n            if ($section.hasClass('section')) {\n\n                if (pages % 2 === 0) {\n                    blankPage($section);\n                }\n\n                computePageFromHeight($section.outerHeight());\n\n                previous = 'section';\n                pages++;\n            }\n            if ($section.hasClass('item')) {\n                if (previous !== 'item') {\n\n                    if (pages % 2 !== 0) {\n                        blankPage($section);\n                    }\n\n                    height = $section.outerHeight();\n                    $section.nextUntil('.section', '.item').each(function () {\n                        height += $(this).outerHeight();\n                    });\n                    computePageFromHeight(height);\n\n                    pages++;\n                }\n                previous = 'item';\n            }\n        });\n    }\n\n    /**\n     * The renderer controller\n     * @exports taoBooklet/controller/printTest/render\n     */\n    return {\n\n        /**\n         * Controller entry point\n         * @param {Object} testData - the packed test data required by the testRunner\n         * @param {Object} options\n         */\n        start: function start(testData, options) {\n\n            var layoutOptions = options && options.layout || {};\n            var layoutClasses = {\n                'one_page_item': 'one-item-per-page',\n                'one_page_section': 'one-section-per-page'\n            };\n\n            //this is just in case something went wrong, but we weren't able to catch it.\n            var timeout = setTimeout(function () {\n                showMessage(\"Something went wrong...\", 'error');\n                ready();\n            }, 45 * 1000);\n\n            //the content will be inserted in a detached element (to save time)\n            var $mainContainer = $(printTpl({\n                cls: _.reduce(layoutOptions, function (list, value, name) {\n                    if (value && layoutClasses[name]) {\n                        list.push(layoutClasses[name]);\n                    }\n                    return list;\n                }, []).join(' ')\n            }));\n\n            /**\n             * As the page can be called by an external tool and\n             * as we build the page in JS asynchronously, we need this hack\n             * to tell the 3rd part tool that the page is ready.\n             */\n            function ready() {\n                window.status = 'DONE';\n            }\n\n            //we attach the container to the DOM\n            $('body').append($mainContainer);\n\n            //instantiate the TestRunner\n            testRunner(testData, options)\n                .on('error', function (e) {\n                    logger.error(e);\n                    showMessage(e, 'error');\n                    ready();\n                })\n                .on('ready', function () {\n\n                    //hack layout calculation\n                    if (layoutOptions['add_blank_pages']) {\n                        printLayoutHacking($mainContainer);\n                    }\n\n                    clearTimeout(timeout);\n\n                    //we are done\n                    ready();\n                })\n                .render($mainContainer);\n        }\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA ;\n */\n/**\n * @author Jean-Sébastien Conan <jean-sebastien@taotesting.com>\n */\ndefine('taoBooklet/component/taskQueue',[\n    'jquery',\n    'lodash',\n    'util/url',\n    'ui/taskQueue/table'\n], function ($, _, urlHelper, taskQueueTableFactory) {\n    'use strict';\n\n    var defaults = {\n        rows: 10,\n        dataUrl: urlHelper.route('getTasks', 'TaskQueueData', 'taoBooklet'),\n        statusUrl: urlHelper.route('getStatus', 'TaskQueueData', 'taoBooklet'),\n        removeUrl: urlHelper.route('archiveTask', 'TaskQueueData', 'taoBooklet')\n    };\n\n    /**\n     * Renders a booklet task queue table component\n     * @param {String} queueId\n     * @param {jQuery} $container\n     * @param {Object} [config]\n     * @returns {taskQueueTable}\n     */\n    function bookletTaskQueue(queueId, $container, config) {\n        var taskQueue = taskQueueTableFactory(_.merge({context: queueId}, config || {}, defaults));\n\n        taskQueue.init()\n            .render($container);\n\n        return taskQueue;\n    }\n\n    return bookletTaskQueue;\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n */\ndefine('taoBooklet/controller/Results/printWizard',[\n    'jquery',\n    'lodash',\n    'ui/hider',\n    'util/url',\n    'report',\n    'taoBooklet/component/taskQueue',\n    'jquery.fileDownload'\n], function ($, _, hider, urlHelper, report, taskQueueTableFactory) {\n    'use strict';\n\n    return {\n        start: function () {\n            var $header = $('header.section-header');\n            var $formContainer = $('.print-form');\n            var $reportContainer = $('.print-report');\n            var $form = $('form', $formContainer);\n            var $submitter = $('.form-submitter', $form);\n            var $sent = $(\":input[name='\" + $form.attr('name') + \"_sent']\", $form);\n            var asyncQueue = $header.data('async-queue');\n            var $containers = $('.main-container');\n\n            function switchContainer(purpose) {\n                hider.hide($containers);\n                hider.show($containers.filter('[data-purpose=\"' + purpose + '\"]'));\n            }\n\n            function refreshTree() {\n                $('.tree').trigger('refresh.taotree', [{\n                    uri : $header.data('select-node')\n                }]);\n            }\n\n            function displayReport(response) {\n                switchContainer('report');\n                $reportContainer.append(response);\n                $submitter.removeAttr('disabled');\n\n                // Fold action (show detailed report)\n                hider.toggle($('#fold', $reportContainer), response.nested);\n                $('#fold > input[type=\"checkbox\"]', $reportContainer).on('click', function() {\n                    report.fold();\n                });\n\n                // Continue button\n                $('#import-continue', $reportContainer).on('click', refreshTree);\n            }\n\n            switchContainer('form');\n\n            //overwrite the submit behaviour\n            $submitter.off('click').on('click', function (e) {\n                var params = {};\n                var instances = [];\n                var classes = [];\n\n                $submitter.attr('disabled', true);\n\n                e.preventDefault();\n                if (parseInt($sent.val(), 10)) {\n                    // prepare download params\n                    _.forEach($form.serializeArray(), function (param) {\n                        if (param.name.indexOf('instances_') === 0) {\n                            instances.push(param.value);\n                        } else if (param.name.indexOf('classes_') === 0) {\n                            classes.push(param.value);\n                        } else {\n                            params[param.name] = param.value;\n                        }\n                    });\n                    params.instances = encodeURIComponent(JSON.stringify(instances));\n                    params.classes = encodeURIComponent(JSON.stringify(classes));\n\n                    if (asyncQueue) {\n                        // display report after form submit\n                        $.ajax({\n                            url: $form.attr('action'),\n                            data: params,\n                            type: 'POST',\n                            dataType: \"text\"\n                        }).done(displayReport);\n                    } else {\n                        // download file after form submit\n                        $.fileDownload($form.attr('action'), {\n                            httpMethod: 'POST',\n                            data: params,\n                            failCallback: displayReport,\n                            successCallback: refreshTree\n                        });\n                    }\n                }\n            });\n\n            if (asyncQueue) {\n                taskQueueTableFactory($header.data('queue'), $containers.filter('.print-tasks'), {\n                    downloadUrl: urlHelper.route('downloadTask', 'TaskQueueData', 'taoBooklet')\n                });\n            }\n        }\n    };\n});\n\n"]}