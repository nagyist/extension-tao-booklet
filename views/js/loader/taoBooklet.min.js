function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}(function(){'use strict';var loaderScript=document.getElementById("amd-loader"),configUrl=loaderScript.getAttribute("data-config"),bundle=loaderScript.getAttribute("data-bundle"),loadController=function(){var controllerOptions={},controllerPath=loaderScript.getAttribute("data-controller"),params=loaderScript.getAttribute("data-params");try{controllerOptions=JSON.parse(params)}catch(err){controllerOptions={}}window.require([controllerPath],function(controller){var startController=function(){window.started||(window.started=!0,controller.start(controllerOptions))};document.addEventListener("readystatechange",startController,!1),"complete"===document.readyState&&startController()})};window.require([configUrl],function(){window.loadBundles||(window.loaded={},window.loadBundles=function(bundles){bundles=bundles||[],bundles=bundles.concat(window.bundles),bundles=bundles.filter(function(item,index){return item&&bundles.indexOf(item)===index&&!0!==window.loaded[item]}),require(bundles,function(){bundles.forEach(function(item){window.loaded[item]=!0}),loadController()})}),bundle||window.bundles&&window.bundles.length?window.loadBundles([bundle]):loadController()})})(),define("loader/bootstrap",function(){}),define("taoBooklet/controller/Booklet/editBooklet",["jquery","lodash","i18n","module","util/url","ui/taskQueue/taskQueue","ui/taskQueueButton/treeButton","layout/actions/binder"],function($,_,__,module,urlHelper,taskQueue,treeTaskButtonFactory,binder){'use strict';return{start:function start(){var taskRegenerateButton,$downloader=$("<iframe/>").hide(),$regenerateBtn=$("#booklet-regenerate");$regenerateBtn.show(),taskRegenerateButton=treeTaskButtonFactory({replace:!0,icon:"reset",label:__("Regenerate"),taskQueue:taskQueue}).render($regenerateBtn),binder.register("booklet_regenerate",function(actionContext){var data=_.pick(actionContext,["uri","classUri","id"]),uniqueValue=data.uri||data.classUri||"";taskRegenerateButton.setTaskConfig({taskCreationUrl:this.url,taskCreationData:{uri:uniqueValue}}).start()}),$("form").append($downloader),$(".btn-download").on("click",function(e){e.preventDefault();var $form=$(e.target).closest("form");$downloader.attr("src",urlHelper.route("download","Booklet","taoBooklet",{uri:$form.find("input[name=\"uri\"]").val(),classUri:$form.find("input[name=\"classUri\"]").val(),id:$form.find("input[name=\"id\"]").val()}))})}}}),define("taoBooklet/controller/Booklet/preview",["jquery"],function($){'use strict';return{start:function start(){var $frame=$(".preview-test"),$container=$frame.closest(".content-container");$frame.css("min-height",$container.height()-50+"px")}}}),define("taoBooklet/controller/Booklet/wizard",["lodash","jquery","i18n","ui/filter","ui/feedback","util/url","layout/actions","core/promise","ui/taskQueue/taskQueue","ui/taskQueueButton/standardButton"],function(_,$,__,filterFactory,feedback,urlUtils,actionManager,Promise,taskQueue,taskCreationButtonFactory){'use strict';var refreshTree=function(uriResource){actionManager.trigger("refresh",{uri:uriResource})};return{start:function start(){var taskCreationButton,$oldSubmitter,$form=$("#form_1"),$container=$form.closest(".content-block"),$regenerateBtn=$("#booklet-regenerate");$regenerateBtn.hide(),$oldSubmitter=$form.find(".form-submitter"),taskCreationButton=taskCreationButtonFactory({type:"info",icon:"play",title:__("Generate booklet"),label:__("Generate"),taskQueue:taskQueue,taskCreationUrl:$form.prop("action"),taskCreationData:function(){return $form.serializeArray()},taskReportContainer:$container}).on("enqueued",function(){refreshTree()}).on("finished",function(result){result.task&&result.task.report&&_.isArray(result.task.report.children)&&result.task.report.children.length&&result.task.report.children[0]?result.task.report.children[0].data&&result.task.report.children[0].data.uriResource?(feedback().info(__("%s completed",result.task.taskLabel)),refreshTree(result.task.report.children[0].data.uriResource)):refreshTree():refreshTree()}).on("continue",function(){refreshTree()}).on("error",function(err){feedback().error(err.errorMessage),$("#booklet-new a").click()}).render($oldSubmitter.closest(".form-toolbar")),$oldSubmitter.replaceWith(taskCreationButton.getElement().css({float:"right"}))}}}),define("tpl!taoBooklet/tpl/print",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",escapeExpression=this.escapeExpression;return buffer+="<main class=\"tao-scope ",(helper=helpers.cls)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.cls,stack1="function"===_typeof(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"></main>",buffer})}),define("taoBooklet/controller/PrintTest/render",["jquery","lodash","core/logger","taoQtiPrint/runner/testRunner","tpl!taoBooklet/tpl/print"],function($,_,loggerFactory,testRunner,printTpl){'use strict';function showMessage(msg,type){type=type||"info",$("body").append("<div class=\"feedback-".concat(type,"\">").concat(msg,"</div>"))}function printLayoutHacking($container){var previous,pages=2,blankPage=function($section){$section.before("<div class=\"breaker\"></div>"),pages++},computePageFromHeight=function(height){height>6000&&(pages+=Math.ceil(height/6000)-1)};$container.children("section").each(function(){var height,$section=$(this);$section.hasClass("section")&&(0==pages%2&&blankPage($section),computePageFromHeight($section.outerHeight()),previous="section",pages++),$section.hasClass("item")&&("item"!==previous&&(0!=pages%2&&blankPage($section),height=$section.outerHeight(),$section.nextUntil(".section",".item").each(function(){height+=$(this).outerHeight()}),computePageFromHeight(height),pages++),previous="item")})}function extractSharedStimulus($container){var hrefs={};$container.find(".qti-include").each(function(){var $include=$(this),href=$include.attr("data-href");if(!hrefs[href]){hrefs[href]=!0;var $section=$include.closest("section.item"),$newSection=$("<section class=\"grid-row include\"></section>");$newSection.append($include),$section.before($newSection)}else $include.remove()})}var logger=loggerFactory("printTest/render");return{start:function(config){function ready(){window.status="DONE"}var testData=config.testData,options=config.options,layoutOptions=options&&options.layout||{},layoutClasses={one_page_item:"one-item-per-page",one_page_section:"one-section-per-page"},timeout=setTimeout(function(){showMessage("Something went wrong...","error"),ready()},45000),$mainContainer=$(printTpl({cls:_.reduce(layoutOptions,function(list,value,name){return value&&layoutClasses[name]&&list.push(layoutClasses[name]),list},[]).join(" ")}));$("body").append($mainContainer),testRunner(testData,options).on("error",function(e){logger.error(e),showMessage(e,"error"),ready()}).on("ready",function(){layoutOptions.add_blank_pages&&printLayoutHacking($mainContainer),extractSharedStimulus($mainContainer),clearTimeout(timeout),ready()}).render($mainContainer)}}}),define("taoBooklet/controller/Results/printWizard",["jquery","lodash","i18n","ui/hider","util/url","ui/feedback","layout/actions/binder","ui/taskQueue/taskQueue","ui/taskQueueButton/standardButton"],function($,_,__,hider,urlHelper,feedback,binder,taskQueue,taskCreationButtonFactory){'use strict';return{start:function start(){function switchContainer(purpose){hider.hide($containers),hider.show($containers.filter("[data-purpose=\""+purpose+"\"]"))}function refreshTree(){$(".tree").trigger("refresh.taotree",[{uri:$header.data("select-node")}])}var taskCreationButton,$header=$("header.section-header"),$formContainer=$(".print-form"),$reportContainer=$(".print-report"),$form=$("form",$formContainer),$submitter=$(".form-submitter",$form),$containers=$(".main-container");switchContainer("form"),taskCreationButton=taskCreationButtonFactory({type:"info",icon:"play",title:__("Generate Results"),label:__("Generate"),taskQueue:taskQueue,taskCreationUrl:$form.prop("action"),taskCreationData:function(){return $form.serializeArray()},taskReportContainer:$reportContainer}).on("finished",function(result){result.task&&result.task.report&&_.isArray(result.task.report.children)&&result.task.report.children.length&&result.task.report.children[0]&&(result.task.report.children[0].data&&result.task.report.children[0].data.uriResource?(feedback().info(__("%s completed",result.task.taskLabel)),refreshTree(result.task.report.children[0].data.uriResource)):(this.displayReport(result.task.report.children[0],__("Error")),switchContainer("report")))}).on("continue",function(){refreshTree()}).on("error",function(err){taskCreationButton.terminate().reset(),this.displayReport(err,__("Error")),switchContainer("report")}).on("enqueued",function(){refreshTree()}).render($submitter.closest(".form-toolbar")),$submitter.replaceWith(taskCreationButton.getElement().css({float:"right"}))}}}),define("taoBooklet/controller/routes",[],function(){'use strict';return{Booklet:{actions:{editBooklet:"controller/Booklet/editBooklet",wizard:"controller/Booklet/wizard",preview:"controller/Booklet/preview"}},Results:{actions:{printWizard:"controller/Results/printWizard"}}}}),define("taoBooklet/component/taskQueue",["jquery","lodash","util/url","ui/taskQueue/table"],function($,_,urlHelper,taskQueueTableFactory){'use strict';var defaults={rows:10,dataUrl:urlHelper.route("getTasks","TaskQueueData","taoBooklet"),statusUrl:urlHelper.route("getStatus","TaskQueueData","taoBooklet"),removeUrl:urlHelper.route("archiveTask","TaskQueueData","taoBooklet")};return function(queueId,$container,config){var taskQueue=taskQueueTableFactory(_.merge({context:queueId},config||{},defaults));return taskQueue.init().render($container),taskQueue}}),define("taoBooklet/loader/taoBooklet.bundle",function(){}),window.bundles=(window.bundles||[]).concat(["taoQtiPrint/loader/taoQtiPrint.min","taoItems/loader/taoItems.min","taoQtiItem/loader/taoQtiItem.min"]);
//# sourceMappingURL=taoBooklet.min.js.map